<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Global site tag (gtag.js) - Google Analytics - START -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156801664-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-156801664-1');
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics - END -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="description" content="3.5.1&nbsp;&nbsp;
    Streams Are Delayed Lists
  " />
    <title>
      3.5.1&nbsp;&nbsp;
    Streams Are Delayed Lists
  
    </title>
    
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token" content="EMTEijVc2kiiKUH4nYH0lQG3pLPfMowQ/Stg//t6DCo0e5pWMQwamnTvIdmVZqY/MqSx2IYYE+2bpNV6UNSMwQ==" />

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display?swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" media="all" href="../assets/stylesheet.css" />

   <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico" />

<!--    <link rel="shortcut icon" type="image/png" href="../images/lambda.png" /> -->

    <!-- for support of progressive web app, see github README, DISABLED!
    <link rel="manifest" href="../static/manifest.json">
    -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" 
		     	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	          crossorigin="anonymous">
    </script> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->
    <script type="text/javascript" 
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script>
   <!--  <script type="text/javascript" 
      src="../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script> -->
  
    <script src="../assets/application.js"></script>
  
    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>

    
    <!-- support for progressive web app, see README, DISABLED
    <script>
      if ('serviceWorker' in navigator && !navigator.serviceWorker.controller) {
          navigator.serviceWorker.register("../sw.js").then(function(reg) {
              console.log("Service worker has been registered for scope: " + reg.scope);
          });
      }
    </script>
    -->

     <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top justify-content-between">
       <button id="btn" class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#nav-sidebar" aria-controls="nav-sidebar" aria-expanded="false" aria-label="Toggle navigation" title="navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <span class="navbar-brand-short"><a title="Go back to front page" href="../index.html" class="gray">SICP &mdash; Scheme/JS</a></span>
       <span class="navbar-brand-long" ><a title="Go back to front page" href="../index.html" class="gray">Structure and Interpretation of Computer Programs &mdash; Comparison Edition</a></span>

       <!-- edit the search engine by visiting: 
	    https://cse.google.com/cse/setup/basic?cx=015760785273492757659:nc_tznrzlsg 
	       -->
       <form class="form-inline ml-auto" id="xxx">
         <div id="search-box">
	         <script>
	           (function() {
	               var cx = "015760785273492757659:nc_tznrzlsg";
	               var gcse = document.createElement("script");
	               gcse.type = "text/javascript";
	               gcse.async = true;
	               gcse.src = "https://cse.google.com/cse.js?cx=" + cx;
	               var s = document.getElementsByTagName("script")[0];
	               s.parentNode.insertBefore(gcse, s);
	           })();
	           window.onload = function()
	           { 
	               var searchBox =  document.getElementById("gsc-i-id1");
	               searchBox.placeholder= "search web edition";
	               searchBox.title= "search web edition";
	           }
	         </script>
	         <gcse:search></gcse:search>
         </div>
       </form>
       <span class="navbar-brand-short">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">S</a>
       </span>
       <span class="navbar-brand-long">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">Source</a>
       </span>
     </nav>
     
     <div class="container scroll">

            
        <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
        <!-- insert a dummy entry, to give one extra line of space -->
        <a class="navbar-brand" href="index.html">&nbsp;</a>
    
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-1">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-1" aria-expanded="false" aria-controls="sidebar-collapse-1">
                <a href="./foreword.html"> 
        Foreword
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-2">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-2" aria-expanded="false" aria-controls="sidebar-collapse-2">
                <a href="./prefaces.html"> 
        Prefaces
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-3">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-3" aria-expanded="false" aria-controls="sidebar-collapse-3">
                <a href="./acknowledgements.html"> 
Acknowledgments
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-4">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-4" aria-expanded="false" aria-controls="sidebar-collapse-4">
                <a href="./see.html"> 
    Index Crossreferences (for proofreading)
  </a>
              </span>
            </h5>
          </div>
        </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-5">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.html">1 
    Building Abstractions with 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-5" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-6">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.1.html">1.1 The Elements of Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-6" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-7">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-7" aria-expanded="false" aria-controls="sidebar-collapse-7">
                <a href="./1.1.1.html"> 1.1.1 Expressions</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-8">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-8" aria-expanded="false" aria-controls="sidebar-collapse-8">
                <a href="./1.1.2.html"> 1.1.2 Naming and the Environment</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-9">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-9" aria-expanded="false" aria-controls="sidebar-collapse-9">
                <a href="./1.1.3.html"> 1.1.3 
    Evaluating
    
      <span style="color:green">Combinations</span>
      <span style="color:blue">Operator Combinations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-10">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-10" aria-expanded="false" aria-controls="sidebar-collapse-10">
                <a href="./1.1.4.html"> 1.1.4 
    Compound <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-11">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-11" aria-expanded="false" aria-controls="sidebar-collapse-11">
                <a href="./1.1.5.html"> 1.1.5 
    The Substitution Model for 
    
      <span style="color:green">
        Procedure
      </span>
      <span style="color:blue">
        Function
      </span>
    
    Application
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-12">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-12" aria-expanded="false" aria-controls="sidebar-collapse-12">
                <a href="./1.1.6.html"> 1.1.6 
    Conditional Expressions and Predicates
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-13">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-13" aria-expanded="false" aria-controls="sidebar-collapse-13">
                <a href="./1.1.7.html"> 1.1.7 Example: Square Roots by Newton's Method</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-14">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-14" aria-expanded="false" aria-controls="sidebar-collapse-14">
                <a href="./1.1.8.html"> 1.1.8 
    
      <span style="color:green">
        Procedures
      </span>
      <span style="color:blue">
        Functions
      </span>
    
    as Black-Box Abstractions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-15">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.2.html">1.2 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    and the Processes They Generate
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-15" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-16">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-16" aria-expanded="false" aria-controls="sidebar-collapse-16">
                <a href="./1.2.1.html"> 1.2.1 Linear Recursion and Iteration</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-17">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-17" aria-expanded="false" aria-controls="sidebar-collapse-17">
                <a href="./1.2.2.html"> 1.2.2 Tree Recursion</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-18">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-18" aria-expanded="false" aria-controls="sidebar-collapse-18">
                <a href="./1.2.3.html"> 1.2.3 Orders of Growth</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-19">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-19" aria-expanded="false" aria-controls="sidebar-collapse-19">
                <a href="./1.2.4.html"> 1.2.4 Exponentiation</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-20">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-20" aria-expanded="false" aria-controls="sidebar-collapse-20">
                <a href="./1.2.5.html"> 1.2.5 Greatest Common Divisors</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-21">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-21" aria-expanded="false" aria-controls="sidebar-collapse-21">
                <a href="./1.2.6.html"> 1.2.6 Example: Testing for Primality</a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-22">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.3.html">1.3 
        Formulating Abstractions with Higher-Order 
        
	  <span style="color:green">Procedures</span>
	  <span style="color:blue">Functions</span>
	
      </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-22" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-23">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-23" aria-expanded="false" aria-controls="sidebar-collapse-23">
                <a href="./1.3.1.html"> 1.3.1 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Arguments
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-24">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-24" aria-expanded="false" aria-controls="sidebar-collapse-24">
                <a href="./1.3.2.html"> 1.3.2 
    
      <span style="color:green">Constructing Procedures using Lambda</span>
      <span style="color:blue">Constructing Functions using Lambda Expressions
      </span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-25">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-25" aria-expanded="false" aria-controls="sidebar-collapse-25">
                <a href="./1.3.3.html"> 1.3.3 
    
      <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
    as General Methods
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-26">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-26" aria-expanded="false" aria-controls="sidebar-collapse-26">
                <a href="./1.3.4.html"> 1.3.4 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Returned Values
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-27">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.html">2 Building Abstractions with Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-27" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-28">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.1.html">2.1 Introduction to Data Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-28" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-29">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-29" aria-expanded="false" aria-controls="sidebar-collapse-29">
                <a href="./2.1.1.html"> 2.1.1 
    Example: Arithmetic Operations for Rational Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-30">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-30" aria-expanded="false" aria-controls="sidebar-collapse-30">
                <a href="./2.1.2.html"> 2.1.2 
    Abstraction Barriers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-31">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-31" aria-expanded="false" aria-controls="sidebar-collapse-31">
                <a href="./2.1.3.html"> 2.1.3 
    What Is Meant by Data?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-32">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-32" aria-expanded="false" aria-controls="sidebar-collapse-32">
                <a href="./2.1.4.html"> 2.1.4 
    Extended Exercise: Interval Arithmetic
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-33">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.2.html">2.2 Hierarchical Data and the Closure Property</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-33" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-34">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-34" aria-expanded="false" aria-controls="sidebar-collapse-34">
                <a href="./2.2.1.html"> 2.2.1 
    Representing Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-35">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-35" aria-expanded="false" aria-controls="sidebar-collapse-35">
                <a href="./2.2.2.html"> 2.2.2 
    Hierarchical Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-36">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-36" aria-expanded="false" aria-controls="sidebar-collapse-36">
                <a href="./2.2.3.html"> 2.2.3 
    Sequences as Conventional Interfaces
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-37">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-37" aria-expanded="false" aria-controls="sidebar-collapse-37">
                <a href="./2.2.4.html"> 2.2.4 
    Example: A Picture Language
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-38">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.3.html">2.3 Symbolic Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-38" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-39">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-39" aria-expanded="false" aria-controls="sidebar-collapse-39">
                <a href="./2.3.1.html"> 2.3.1 
    
      <span style="color:green">Quotation</span>
      <span style="color:blue">Strings</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-40">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-40" aria-expanded="false" aria-controls="sidebar-collapse-40">
                <a href="./2.3.2.html"> 2.3.2 
    Example: Symbolic Differentiation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-41">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-41" aria-expanded="false" aria-controls="sidebar-collapse-41">
                <a href="./2.3.3.html"> 2.3.3 
    Example: Representing Sets
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-42">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-42" aria-expanded="false" aria-controls="sidebar-collapse-42">
                <a href="./2.3.4.html"> 2.3.4 
    Example: Huffman Encoding Trees
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-43">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.4.html">2.4 Multiple Representations for Abstract Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-43" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-44">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-44" aria-expanded="false" aria-controls="sidebar-collapse-44">
                <a href="./2.4.1.html"> 2.4.1 
    Representations for Complex Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-45">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-45" aria-expanded="false" aria-controls="sidebar-collapse-45">
                <a href="./2.4.2.html"> 2.4.2 
    Tagged data
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-46">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-46" aria-expanded="false" aria-controls="sidebar-collapse-46">
                <a href="./2.4.3.html"> 2.4.3 
    Data-Directed Programming and Additivity
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-47">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.5.html">2.5 Systems with Generic Operations</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-47" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-48">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-48" aria-expanded="false" aria-controls="sidebar-collapse-48">
                <a href="./2.5.1.html"> 2.5.1 
    Generic Arithmetic Operations
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-49">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-49" aria-expanded="false" aria-controls="sidebar-collapse-49">
                <a href="./2.5.2.html"> 2.5.2 
    Combining Data of Different Types
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-50">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-50" aria-expanded="false" aria-controls="sidebar-collapse-50">
                <a href="./2.5.3.html"> 2.5.3 
    Example: Symbolic Algebra
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-51">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.html">3 Modularity, Objects, and State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-51" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-52">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.1.html">3.1 Assignment and Local State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-52" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-53">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-53" aria-expanded="false" aria-controls="sidebar-collapse-53">
                <a href="./3.1.1.html"> 3.1.1 
    Local State Variables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-54">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-54" aria-expanded="false" aria-controls="sidebar-collapse-54">
                <a href="./3.1.2.html"> 3.1.2 
    The Benefits of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-55">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-55" aria-expanded="false" aria-controls="sidebar-collapse-55">
                <a href="./3.1.3.html"> 3.1.3 
    The Costs of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-56">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.2.html">3.2 The Environment Model of Evaluation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-56" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-57">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-57" aria-expanded="false" aria-controls="sidebar-collapse-57">
                <a href="./3.2.1.html"> 3.2.1 
    The Rules for Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-58">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-58" aria-expanded="false" aria-controls="sidebar-collapse-58">
                <a href="./3.2.2.html"> 3.2.2 
    Applying Simple
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-59">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-59" aria-expanded="false" aria-controls="sidebar-collapse-59">
                <a href="./3.2.3.html"> 3.2.3 
    Frames as the Repository of Local State
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-60">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-60" aria-expanded="false" aria-controls="sidebar-collapse-60">
                <a href="./3.2.4.html"> 3.2.4 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-61">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.3.html">3.3 Modeling with Mutable Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-61" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-62">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-62" aria-expanded="false" aria-controls="sidebar-collapse-62">
                <a href="./3.3.1.html"> 3.3.1 
    Mutable List Structure
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-63">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-63" aria-expanded="false" aria-controls="sidebar-collapse-63">
                <a href="./3.3.2.html"> 3.3.2 
    Representing Queues
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-64">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-64" aria-expanded="false" aria-controls="sidebar-collapse-64">
                <a href="./3.3.3.html"> 3.3.3 
    Representing Tables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-65">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-65" aria-expanded="false" aria-controls="sidebar-collapse-65">
                <a href="./3.3.4.html"> 3.3.4 
    A Simulator for Digital Circuits
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-66">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-66" aria-expanded="false" aria-controls="sidebar-collapse-66">
                <a href="./3.3.5.html"> 3.3.5 
    Propagation of Constraints
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-67">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.4.html">3.4 Concurrency: Time Is of the Essence</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-67" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-68">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-68" aria-expanded="false" aria-controls="sidebar-collapse-68">
                <a href="./3.4.1.html"> 3.4.1 
    The Nature of Time in Concurrent Systems
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-69">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-69" aria-expanded="false" aria-controls="sidebar-collapse-69">
                <a href="./3.4.2.html"> 3.4.2 
    Mechanisms for Controlling Concurrency
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-70">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.5.html">3.5 Streams</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-70" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-71">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-71" aria-expanded="false" aria-controls="sidebar-collapse-71">
                <a href="./3.5.1.html"> 3.5.1 
    Streams Are Delayed Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-72">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-72" aria-expanded="false" aria-controls="sidebar-collapse-72">
                <a href="./3.5.2.html"> 3.5.2 
    Infinite Streams
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-73">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-73" aria-expanded="false" aria-controls="sidebar-collapse-73">
                <a href="./3.5.3.html"> 3.5.3 
    Exploiting the Stream Paradigm
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-74">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-74" aria-expanded="false" aria-controls="sidebar-collapse-74">
                <a href="./3.5.4.html"> 3.5.4 
    Streams and Delayed Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-75">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-75" aria-expanded="false" aria-controls="sidebar-collapse-75">
                <a href="./3.5.5.html"> 3.5.5 
    Modularity of Functional Programs and Modularity of Objects
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-76">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.html">4 Metalinguistic Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-76" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-77">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.1.html">4.1 The Metacircular Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-77" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-78">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-78" aria-expanded="false" aria-controls="sidebar-collapse-78">
                <a href="./4.1.1.html"> 4.1.1 
    The Core of the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-79">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-79" aria-expanded="false" aria-controls="sidebar-collapse-79">
                <a href="./4.1.2.html"> 4.1.2 
    Representing
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-80">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-80" aria-expanded="false" aria-controls="sidebar-collapse-80">
                <a href="./4.1.3.html"> 4.1.3 
    Evaluator Data Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-81">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-81" aria-expanded="false" aria-controls="sidebar-collapse-81">
                <a href="./4.1.4.html"> 4.1.4 
    Running the Evaluator as a Program
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-82">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-82" aria-expanded="false" aria-controls="sidebar-collapse-82">
                <a href="./4.1.5.html"> 4.1.5 
    Data as Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-83">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-83" aria-expanded="false" aria-controls="sidebar-collapse-83">
                <a href="./4.1.6.html"> 4.1.6 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-84">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-84" aria-expanded="false" aria-controls="sidebar-collapse-84">
                <a href="./4.1.7.html"> 4.1.7 
    Separating Syntactic Analysis from Execution
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-85">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.2.html">4.2 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Lazy Evaluation
</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-85" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-86">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-86" aria-expanded="false" aria-controls="sidebar-collapse-86">
                <a href="./4.2.1.html"> 4.2.1 
    Normal Order and Applicative Order
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-87">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-87" aria-expanded="false" aria-controls="sidebar-collapse-87">
                <a href="./4.2.2.html"> 4.2.2 
    An Interpreter with Lazy Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-88">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-88" aria-expanded="false" aria-controls="sidebar-collapse-88">
                <a href="./4.2.3.html"> 4.2.3 
    Streams as Lazy Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-89">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.3.html">4.3 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Nondeterministic Computing
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-89" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-90">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-90" aria-expanded="false" aria-controls="sidebar-collapse-90">
                <a href="./4.3.1.html"> 4.3.1 
    
      <span style="color:green">Amb and Search</span>
      <span style="color:blue">Search and amb</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-91">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-91" aria-expanded="false" aria-controls="sidebar-collapse-91">
                <a href="./4.3.2.html"> 4.3.2 
    Examples of Nondeterministic Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-92">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-92" aria-expanded="false" aria-controls="sidebar-collapse-92">
                <a href="./4.3.3.html"> 4.3.3 
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-93">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.4.html">4.4 Logic Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-93" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-94">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-94" aria-expanded="false" aria-controls="sidebar-collapse-94">
                <a href="./4.4.1.html"> 4.4.1 
    Deductive Information Retrieval
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-95">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-95" aria-expanded="false" aria-controls="sidebar-collapse-95">
                <a href="./4.4.2.html"> 4.4.2 
    How the Query System Works
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-96">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-96" aria-expanded="false" aria-controls="sidebar-collapse-96">
                <a href="./4.4.3.html"> 4.4.3 
    Is Logic Programming Mathematical Logic?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-97">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-97" aria-expanded="false" aria-controls="sidebar-collapse-97">
                <a href="./4.4.4.html"> 4.4.4 
    Implementing the Query System
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-98">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.html">5 Computing with Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-98" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-99">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.1.html">5.1 Designing Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-99" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-100">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-100" aria-expanded="false" aria-controls="sidebar-collapse-100">
                <a href="./5.1.1.html"> 5.1.1 
    A Language for Describing Register Machines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-101">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-101" aria-expanded="false" aria-controls="sidebar-collapse-101">
                <a href="./5.1.2.html"> 5.1.2 
    Abstraction in Machine Design
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-102">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-102" aria-expanded="false" aria-controls="sidebar-collapse-102">
                <a href="./5.1.3.html"> 5.1.3 
    Subroutines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-103">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-103" aria-expanded="false" aria-controls="sidebar-collapse-103">
                <a href="./5.1.4.html"> 5.1.4 
    Using a Stack to Implement Recursion
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-104">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-104" aria-expanded="false" aria-controls="sidebar-collapse-104">
                <a href="./5.1.5.html"> 5.1.5 
    Instruction Summary
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-105">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.2.html">5.2 A Register-Machine Simulator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-105" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-106">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-106" aria-expanded="false" aria-controls="sidebar-collapse-106">
                <a href="./5.2.1.html"> 5.2.1 
    The Machine Model
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-107">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-107" aria-expanded="false" aria-controls="sidebar-collapse-107">
                <a href="./5.2.2.html"> 5.2.2 
    The Assembler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-108">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-108" aria-expanded="false" aria-controls="sidebar-collapse-108">
                <a href="./5.2.3.html"> 5.2.3 
    Generating Execution
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    for Instructions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-109">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-109" aria-expanded="false" aria-controls="sidebar-collapse-109">
                <a href="./5.2.4.html"> 5.2.4 
    Monitoring Machine Performance
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-110">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.3.html">5.3 Storage Allocation and Garbage Collection</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-110" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-111">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-111" aria-expanded="false" aria-controls="sidebar-collapse-111">
                <a href="./5.3.1.html"> 5.3.1 
    Memory as Vectors
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-112">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-112" aria-expanded="false" aria-controls="sidebar-collapse-112">
                <a href="./5.3.2.html"> 5.3.2 
    Maintaining the Illusion of Infinite Memory
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-113">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.4.html">5.4 The Explicit-Control Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-113" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-114">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-114" aria-expanded="false" aria-controls="sidebar-collapse-114">
                <a href="./5.4.1.html"> 5.4.1 
    The Core of the Explicit-Control Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-115">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-115" aria-expanded="false" aria-controls="sidebar-collapse-115">
                <a href="./5.4.2.html"> 5.4.2 
    Return Statements and Tail Recursion
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-116">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-116" aria-expanded="false" aria-controls="sidebar-collapse-116">
                <a href="./5.4.3.html"> 5.4.3 
    Conditionals, Assignments<span style="color:green">, and Definitions</span><span style="color:blue">, and Declarations</span>
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-117">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-117" aria-expanded="false" aria-controls="sidebar-collapse-117">
                <a href="./5.4.4.html"> 5.4.4 
    Running the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-118">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.5.html">5.5 Compilation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-118" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-119">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-119" aria-expanded="false" aria-controls="sidebar-collapse-119">
                <a href="./5.5.1.html"> 5.5.1 
    Structure of the Compiler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-120">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-120" aria-expanded="false" aria-controls="sidebar-collapse-120">
                <a href="./5.5.2.html"> 5.5.2 
    Compiling
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-121">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-121" aria-expanded="false" aria-controls="sidebar-collapse-121">
                <a href="./5.5.3.html"> 5.5.3 
    Compiling
    
      <span style="color:green">
	Combinations
      </span>
      <span style="color:blue">
	Applications
      </span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-122">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-122" aria-expanded="false" aria-controls="sidebar-collapse-122">
                <a href="./5.5.4.html"> 5.5.4 
    Combining Instruction Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-123">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-123" aria-expanded="false" aria-controls="sidebar-collapse-123">
                <a href="./5.5.5.html"> 5.5.5 
    An Example of Compiled Code
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-124">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-124" aria-expanded="false" aria-controls="sidebar-collapse-124">
                <a href="./5.5.6.html"> 5.5.6 
    Lexical Addressing
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-125">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-125" aria-expanded="false" aria-controls="sidebar-collapse-125">
                <a href="./5.5.7.html"> 5.5.7 
    Interfacing Compiled Code to the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-126">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-126" aria-expanded="false" aria-controls="sidebar-collapse-126">
                <a href="./references.html"> References</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-127">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-127" aria-expanded="false" aria-controls="sidebar-collapse-127">
                <a href="./making-of.html"> About the SICP JS Project</a>
              </span>
            </h5>
          </div>
        </div>
        </div>
<div id='permalink-msg'>
<div class='screen'>
  <div class='alert alert-success'>
    <strong>Permalink copied!</strong>
  </div>
</div>
</div>
<div class='chapter-content'>

      <div class='chapter-title'>
        <div class='permalink'>
        <a name='top' class='permalink'> 
    3.5.1&nbsp;&nbsp;
    Streams Are Delayed Lists
  
        </a>
        </div>
      </div>
      <div class='chapter-text'>
        <div class='SECTION'>
    

  
  
  <div class='permalink'>
<a name='p1' class='permalink'></a><p>
    As we saw in
    section&nbsp;<REF NAME="sec:sequences-conventional-interfaces"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>,
    sequences can serve as standard interfaces for combining program
    modules.  We formulated powerful abstractions for manipulating
    sequences, such as <kbd>map</kbd>,
    <kbd>filter</kbd>, and
    <kbd>accumulate</kbd>, that capture a wide variety of
    operations in a manner that is both succinct and elegant.
  </p></div>

  <div class='permalink'>
<a name='p2' class='permalink'></a><p>
    Unfortunately, if we represent sequences as lists, this elegance is
    bought at the price of severe inefficiency with respect to both the
    time and space required by our computations.
    When we represent manipulations on sequences as transformations
    of lists, our programs must construct and copy data structures (which
    may be huge) at every step of a process.
  </p></div>

  <div class='permalink'>
<a name='p3' class='permalink'></a><p>
    To see why this is true, let us compare two programs for computing the
    sum of all the prime numbers in an interval.  The first program is
    written in standard iterative style:<a class='superscript' id='footnote-link-1' href='#footnote-1'>[1]</a>
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_70_1_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (sum-primes a b)
  (define (iter count accum)
    (cond ((> count b) accum)
          ((prime? count) (iter (+ count 1) (+ count accum)))
          (else (iter (+ count 1) accum))))
  (iter a 0))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_70_1_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMIh6SHQ2HXW6gB4I9xxUGgKhZJxkGikCjhVhkMjEx7TJGgFls0CNO5LaZiDqc7l6MXivrgqEwniCkgUfiy6YdRmcZms1X7Q7hFUUA1Snka5YMpncY0G7Acrk81TuDRPTwlK06m7hf7HDS4BjE0lK64AdnC2AAHFFlEA')">function sum_primes(a, b) {
    function iter(count, accum) {
        return count > b
               ? accum
               : is_prime(count)
               ? iter(count + 1, count + accum)
               : iter(count + 1, accum);
    }
    return iter(a, 0);
}
</pre></div></div></td></tr></table>
    
    The second program performs the same computation using the sequence
    operations of
    section&nbsp;<REF NAME="sec:sequences-conventional-interfaces"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>:
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_70_2_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (sum-primes a b)
  (accumulate +
              0
              (filter prime? (enumerate-interval a b))))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_70_2_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKgTgkIiw9isLLmPxZdg2IzcQw0ADu4QAFlQAOasx5FTwlUCMpmgRrsrlLdpNIjGcXuPoQ1hUJyC0Iy6biYmkzjkynUrV0wwM5n7Q5sznc44afHnUqkyHQ2HXW6gB4Ip587ysMhkUlSik8PjhACegm+jTkB0DKrV0da-yjMYTvkMNO44KhMM44VVCejGrJfqpJBp+pu9345bxDFt6Yd3AA7OFsAAOKLKIA')">function sum_primes(a, b) {
    return accumulate((x, y) => x + y,
                      0,
                      filter(is_prime, 
                             enumerate_interval(a, b)));
}
</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p4' class='permalink'></a><p>
    In carrying out the computation, the first program needs to store only
    the sum being accumulated.  In contrast, the filter in the second
    program cannot do any testing until 
    
      <span style="color:green"><kbd>enumerate-interval</kbd></span>
      <span style="color:blue"><kbd>enumerate_interval</kbd>
      </span>
    
    has constructed a complete list of the numbers in the interval.
    The filter generates another list, which in turn is passed to 
    <kbd>accumulate</kbd> before being collapsed to form
    a sum.  Such large intermediate storage is not needed by the first program,
    which we can think of as enumerating the interval incrementally, adding
    each prime to the sum as it is generated.
  </p></div>

  <div class='permalink'>
<a name='p5' class='permalink'></a><p>
    The inefficiency in using lists becomes painfully apparent if we use
    the sequence paradigm to compute the second prime in the interval from
    10,000 to 1,000,000 by evaluating the expression
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_70_3_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(car (cdr (filter prime?
                  (enumerate-interval 10000 1000000))))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_70_3_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
head(tail(filter(is_prime,
                 enumerate_interval(10000, 1000000))));</pre></div></div></td></tr></table>
    This expression does find the second prime, but the computational overhead
    is outrageous. We construct a list of almost a million integers, filter
    this list by testing each element for primality, and then ignore almost
    all of the result.  In a more traditional programming style, we would
    interleave the enumeration and the filtering, and stop when we reached
    the second prime.
  </p></div>

  <div class='permalink'>
<a name='p6' class='permalink'></a><p>
    Streams are a clever idea that allows one to use sequence
    manipulations without incurring the costs of manipulating sequences as
    lists.  With streams we can achieve the best of both worlds: We can
    formulate programs elegantly as sequence manipulations, while attaining
    the efficiency of incremental computation.  The basic idea is to arrange
    to construct a stream only partially, and to pass the partial
    construction to the program that consumes the stream.  If the consumer
    attempts to access a part of the stream that has not yet been
    constructed, the stream will automatically construct just enough more
    of itself to produce the required part, thus preserving the illusion
    that the entire stream exists.  In other words, although we will write
    programs as if we were processing complete sequences, we design our
    stream implementation to automatically and transparently interleave
    the construction of the stream with its use.
  </p></div>

  <span class='comment'>
    The special form <kbd>delay</kbd> allowed the authors
    of the original version to (1) hide the lambda being constructed, and (2)
    elegantly sneak in the memoization optimization. There are no special forms
    in JavaScript, so the lambda expression in the tail of a stream must be
    explicit. This is not much
    of a loss; streams are somewhat demystified with explicit lambda expressions.
    We decided to <EM>not</EM> use memoization as default, in order to keep
    stream tails in their bare lambda expression simplicity. We mention
    memoization at the end of this section as an optional optimization, and
    refer to this variant in a few exercises in the following sections.
  </span>
  
  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
      <div class='permalink'>
<a name='p7' class='permalink'></a><p>
        On the surface, streams are just lists with different names for the
	procedures that manipulate them.  There is a constructor,
        
        <kbd>cons-stream</kbd>, and two selectors, 
         
        <kbd>stream-car</kbd> and 
         
        <kbd>stream-cdr</kbd>, which satisfy the constraints
        \begin{eqnarray*}
        \mbox{(stream-car (cons-stream x y))} &=& \mbox{x} \\
        \mbox{(stream-cdr (cons-stream x y))} &=& \mbox{y}
        \end{eqnarray*}
        There is a distinguishable object, 
        
	
         
        <kbd>the-empty-stream</kbd>, which
        cannot be the result of any <kbd>cons-stream</kbd>
	operation, and which can be identified with the predicate 
         
        <kbd>stream-null?</kbd>.<a class='superscript' id='footnote-link-2' href='#footnote-2'style="color:green">[2]</a>
      </p></div>

      <div class='permalink'>
<a name='p8' class='permalink'></a><p>
        Thus we can make and use streams, in just the same way as we can make
        and use lists, to represent aggregate data arranged in a sequence.  In
        particular, we can build stream analogs of the list operations from
        chapter&nbsp;2, such as <kbd>list-ref</kbd>,
	<kbd>map</kbd>, and
	<kbd>for-each</kbd>:<a class='superscript' id='footnote-link-3' href='#footnote-3'style="color:green">[3]</a>
         
         
         
        <div class='snippet' id='javascript_70_4_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (stream-ref s n)
  (if (= n 0)
      (stream-car s)
      (stream-ref (stream-cdr s) (- n 1))))

(define (stream-map proc s)
  (if (stream-null? s)
      the-empty-stream
      (cons-stream (proc (stream-car s))
                   (stream-map proc (stream-cdr s)))))

(define (stream-for-each proc s)
  (if (stream-null? s)
      'done
      (begin (proc (stream-car s))
             (stream-for-each proc (stream-cdr s)))))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p9' class='permalink'></a><p>
        <kbd>Stream-for-each</kbd> is useful for viewing
	streams:
         
         
        <div class='snippet' id='javascript_70_5_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (display-stream s)
  (stream-for-each display-line s))

(define (display-line x)
  (newline)
  (display x))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p10' class='permalink'></a><p>
        To make the stream implementation automatically and transparently
        interleave the construction of a stream with its use, we will arrange
        for the <kbd>cdr</kbd> of a stream to be evaluated
	when it is accessed by the <kbd>stream-cdr</kbd>
	procedure rather than when the stream is constructed by
	<kbd>cons-stream</kbd>.  This implementation choice
	is reminiscent of our discussion of rational numbers in
        section&nbsp;<REF NAME="sec:abstraction-barriers"><a class="superscript" id="3.5.1-sec-link-2.1.2" href="./2.1.2.html">2.1.2</a></REF>, where we saw
	that we can choose to implement rational numbers so that the reduction
	of numerator and denominator to lowest terms is performed either at
        construction time or at selection time.  The two rational-number
        implementations produce the same data abstraction, but the choice has
        an effect on efficiency.  There is a similar relationship between
        streams and ordinary lists.  As a data abstraction, streams are the
        same as lists.  The difference is the time at which the elements are
        evaluated.  With ordinary lists, both the
	<kbd>car</kbd> and the <kbd>cdr</kbd>
        are evaluated at construction time.  With streams, the
	<kbd>cdr</kbd> is evaluated at selection time.
      </p></div>

      <div class='permalink'>
<a name='p11' class='permalink'></a><p>
        
	
        Our implementation of streams will be based on a special form called
        <kbd>delay</kbd>.  Evaluating
	<kbd>(delay ^exp^)</kbd>
	does not evaluate the expression exp, but
	rather returns a so-called
        
        <EM>delayed object</EM>, which we can think of as a
	<QUOTE>promise</QUOTE> to evaluate exp at
	some future time. As a companion to <kbd>delay</kbd>,
	there is a procedure called 
         
        <kbd>force</kbd> that takes a delayed object as
        argument and performs the evaluation—in effect, forcing the
        <kbd>delay</kbd> to fulfill its promise.  We will see
	below how <kbd>delay</kbd> and
	<kbd>force</kbd> can be implemented, but first let us
	use these to construct streams.
      </p></div>

      <div class='permalink'>
<a name='p12' class='permalink'></a><p>
        
        
        <kbd>Cons-stream</kbd> is a special form defined so
	that
        <div class='snippet' id='javascript_70_6_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons-stream ^a^ ^b^)</pre></div></div>
        is equivalent to
        <div class='snippet' id='javascript_70_7_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons ^a^ (delay ^b^))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p13' class='permalink'></a><p>
        What this means is that we will construct streams using pairs.  However,
        rather than placing the value of the rest of the stream
        into the <kbd>cdr</kbd> of the
        pair we will put there a promise to compute the rest if it is ever
        requested.  <kbd>Stream-car</kbd> and
	<kbd>stream-cdr</kbd> can now be defined as procedures:
         
         
        <div class='snippet' id='javascript_70_8_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (stream-car stream) (car stream))

(define (stream-cdr stream) (force (cdr stream)))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p14' class='permalink'></a><p>
        <kbd>Stream-car</kbd> selects the
	<kbd>car</kbd> of the pair;
	<kbd>stream-cdr</kbd> selects the
	<kbd>cdr</kbd> of the pair and evaluates the delayed
	expression found there to obtain the rest of the
	stream.<a class='superscript' id='footnote-link-4' href='#footnote-4'style="color:green">[4]</a>
        
      </p></div>

      
      <div class='permalink'>
        <a name='h1' class='permalink'></a><h2>
     
        The stream implementation in action
      </h2></div>

      <div class='permalink'>
<a name='p15' class='permalink'></a><p>
        To see how this implementation behaves, let us analyze the
        <QUOTE>outrageous</QUOTE> prime computation we saw above, reformulated
	in terms of streams:
        <div class='snippet' id='javascript_70_9_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(stream-car
 (stream-cdr
  (stream-filter prime?
                 (stream-enumerate-interval 10000 1000000))))</pre></div></div>
        We will see that it does indeed work efficiently.
      </p></div>

      <div class='permalink'>
<a name='p16' class='permalink'></a><p>
        We begin by calling
	<kbd>stream-enumerate-interval</kbd> with the
	arguments 10,000 and 1,000,000.
	<kbd>Stream-enumerate-interval</kbd> is the stream
	analog of <kbd>enumerate-interval</kbd>
        (section&nbsp;<REF NAME="sec:sequence-operations"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>):
         
        <div class='snippet' id='javascript_70_10_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (stream-enumerate-interval low high)
  (if (> low high)
      the-empty-stream
      (cons-stream
       low
       (stream-enumerate-interval (+ low 1) high))))</pre></div></div>
        and thus the result returned by
	<kbd>stream-enumerate-interval</kbd>, formed by the
	<kbd>cons-stream</kbd>, is<a class='superscript' id='footnote-link-5' href='#footnote-5'style="color:green">[5]</a>
        <div class='snippet' id='javascript_70_11_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons 10000
      (delay (stream-enumerate-interval 10001 1000000)))</pre></div></div>
        That is, <kbd>stream-enumerate-interval</kbd> returns
	a stream represented as a pair whose <kbd>car</kbd>
        is 10,000 and whose <kbd>cdr</kbd> is a promise to
	enumerate more of the interval if so requested.  This stream is now
	filtered for primes, using the stream analog of the
	<kbd>filter</kbd> procedure
        (section&nbsp;<REF NAME="sec:sequence-operations"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>):
         
        <div class='snippet' id='javascript_70_12_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (stream-filter pred stream)
  (cond ((stream-null? stream) the-empty-stream)
        ((pred (stream-car stream))
         (cons-stream (stream-car stream)
                      (stream-filter pred
                                     (stream-cdr stream))))
        (else (stream-filter pred (stream-cdr stream)))))</pre></div></div>
        <kbd>Stream-filter</kbd> tests the
	<kbd>stream-car</kbd> of the stream (the
	<kbd>car</kbd> of the pair, which is 10,000).
	Since this is not prime,
        <kbd>stream-filter</kbd> examines the
	<kbd>stream-cdr</kbd> of its input
        stream.  The call to <kbd>stream-cdr</kbd> forces
	evaluation of the delayed
	<kbd>stream-enumerate-interval</kbd>, which now returns
        <div class='snippet' id='javascript_70_13_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons 10001
      (delay (stream-enumerate-interval 10002 1000000)))</pre></div></div>
        <kbd>Stream-filter</kbd> now looks at the
	<kbd>stream-car</kbd> of this stream,
        10,001, sees that this is not prime either, forces another
	<kbd>stream-cdr</kbd>, and so on, until
	<kbd>stream-enumerate-interval</kbd> yields
        the prime 10,007, whereupon <kbd>stream-filter</kbd>,
	according to its definition, returns
        <div class='snippet' id='javascript_70_14_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons-stream (stream-car stream)
             (stream-filter pred (stream-cdr stream)))</pre></div></div>
        which in this case is
        <div class='snippet' id='javascript_70_15_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons 10007
      (delay
       (stream-filter
        prime?
        (cons 10008
              (delay
               (stream-enumerate-interval 10009
                                          1000000))))))</pre></div></div>
        This result is now passed to <kbd>stream-cdr</kbd> in
	our original expression.  This forces the delayed
	<kbd>stream-filter</kbd>, which in turn keeps forcing
	the delayed <kbd>stream-enumerate-interval</kbd> until
	it finds the next prime, which is 10,009.  Finally, the result passed to
	<kbd>stream-car</kbd>	in our original expression is
        <div class='snippet' id='javascript_70_16_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(cons 10009
      (delay
       (stream-filter
        prime?
        (cons 10010
              (delay
               (stream-enumerate-interval 10011
                                          1000000))))))</pre></div></div>
        <kbd>Stream-car</kbd> returns 10,009, and the
	computation is complete. Only as many integers were tested for primality
	as were necessary to find the second prime, and the interval was
	enumerated only as far as was necessary to feed the prime filter.
      </p></div>

      <div class='permalink'>
<a name='p17' class='permalink'></a><p>
        In general, we can think of delayed evaluation as 
        
        <QUOTE>demand-driven</QUOTE>
        programming, whereby each stage in the stream process is activated
        only enough to satisfy the next stage.  What we have done is to
        
        decouple the actual order of events in the computation from the apparent
	structure of our procedures. We write procedures as if the streams
	existed <QUOTE>all at once</QUOTE> when, in reality, the computation is
        performed incrementally, as in traditional programming styles.
      </p></div>

      
      <div class='permalink'>
        <a name='h2' class='permalink'></a><h2>
     
        Implementing delay and
	force
      </h2></div>

      <div class='permalink'>
<a name='p18' class='permalink'></a><p>
        
        Although <kbd>delay</kbd> and
	<kbd>force</kbd> may seem like mysterious operations,
	their implementation is really quite straightforward.
        <kbd>Delay</kbd> must package an expression so that it
	can be evaluated later on demand, and we can accomplish this simply by
	treating the expression as the body of a procedure.
	<kbd>Delay</kbd> can be a special form such that
        <div class='snippet' id='javascript_70_17_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(delay ^exp^)</pre></div></div>
        is syntactic sugar for
        <div class='snippet' id='javascript_70_18_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(lambda () ^exp^)</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p19' class='permalink'></a><p>
        <kbd>Force</kbd> simply calls the procedure
        (of no arguments) produced by <kbd>delay</kbd>,
	so we can implement <kbd>force</kbd> as
        a procedure:
         
        <div class='snippet' id='javascript_70_19_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (force delayed-object)
  (delayed-object))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p20' class='permalink'></a><p>
        
        
        This implementation suffices for <kbd>delay</kbd> and
	<kbd>force</kbd> to work as advertised, but there is
	an important optimization that we can include.  In many applications, we
	end up forcing the same delayed object many times.  This can lead to
	serious inefficiency in recursive programs involving streams.  (See
        exercise&nbsp;<REF NAME="ex:fib-stream-efficiency"><a class="superscript" id="3.5.1-ex-link-3.60" href="./3.5.2.html#ex_3.60">3.60</a></REF>.)  The solution
	is to build delayed objects so that the first time they are forced, they
	store the value that is computed.  Subsequent forcings will simply
	return the stored value without repeating the computation.  In other
	words, we implement <kbd>delay</kbd> as a
	special-purpose memoized procedure similar to the one described in
	exercise&nbsp;<REF NAME="ex:memoization"><a class="superscript" id="3.5.1-ex-link-3.27" href="./3.3.3.html#ex_3.27">3.27</a></REF>. One way to accomplish this
	is to use the following procedure, which takes as argument a procedure
        (of no arguments) and returns a memoized version of the procedure. The
	first time the memoized procedure is run, it saves the computed result.
	On subsequent evaluations, it simply returns the result.
         
        <div class='snippet' id='javascript_70_20_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (memo-proc proc)
  (let ((already-run? false) (result false))
    (lambda ()
      (if (not already-run?)
          (begin (set! result (proc))
            (set! already-run? true)
            result)
          result))))</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p21' class='permalink'></a><p>
        <kbd>Delay</kbd> is then defined so that
	<kbd>(delay ^exp^)</kbd> is equivalent to
        <div class='snippet' id='javascript_70_21_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(memo-proc (lambda () ^exp^))</pre></div></div>
        and <kbd>force</kbd> is as defined
	previously.<a class='superscript' id='footnote-link-6' href='#footnote-6'style="color:green">[6]</a>
      </p></div>

      
    <div class="permalink">
    <a name="ex_3.50" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.50">Exercise 3.50 </a></b> 
  
	
	Complete the following definition, which
	generalizes <kbd>stream-map</kbd> to allow procedures
	that take multiple arguments, analogous to
	<kbd>map</kbd> in
	section&nbsp;<REF NAME="sec:sequence-operations"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>,
	footnote&nbsp;<REF NAME="foot:generalmap"><a class="superscript" id="3.5.1-foot-link-8" href="./2.2.1.html#footnote-8">8</a></REF>.
        
	<div class='snippet' id='javascript_70_22_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (stream-map proc . argstreams)
  (if (^??^ (car argstreams))
      the-empty-stream
      (^??^
       (apply proc (map ^??^ argstreams))
       (apply stream-map
              (cons proc (map ^??^ argstreams))))))</pre></div></div>
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_1_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_1_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

      
      
    <div class="permalink">
    <a name="ex_3.51" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.51">Exercise 3.51 </a></b> 
  
	
	
	In order to take a closer look at delayed evaluation, we will use the
	following procedure, which simply returns its argument after printing it:
	<div class='snippet' id='javascript_70_23_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (show x)
  (display-line x)
  x)</pre></div></div>
	What does the interpreter print in response to evaluating each
	expression in the following sequence?<a class='superscript' id='footnote-link-7' href='#footnote-7'style="color:green">[7]</a>
	<div class='snippet' id='javascript_70_24_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define x (stream-map show (stream-enumerate-interval 0 10)))

(stream-ref x 5)

(stream-ref x 7)</pre></div></div>
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_2_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_2_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


      
    <div class="permalink">
    <a name="ex_3.52" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.52">Exercise 3.52 </a></b> 
  
        
        Consider the sequence of expressions
        <div class='snippet' id='javascript_70_25_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define sum 0)

(define (accum x)
  (set! sum (+ x sum))
  sum)

(define seq (stream-map accum (stream-enumerate-interval 1 20)))
(define y (stream-filter even? seq))
(define z (stream-filter (lambda (x) (= (remainder x 5) 0))
                         seq))

(stream-ref y 7)

(display-stream z)</pre></div></div>
        What is the value of <kbd>sum</kbd> after each of the
	above expressions is evaluated?  What is the printed response to
	evaluating the <kbd>stream-ref</kbd> and
	<kbd>display-stream</kbd> expressions?  Would these
	responses differ if we had implemented
	<kbd>(delay~^exp^)</kbd> simply as
        <kbd>(lambda () ^exp^)</kbd> without using the
	optimization provided by
        <kbd>memo\?proc</kbd>$\,$?
	Explain.
        
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_3_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_3_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

    </span>    </td>
          <td></td>
          <td><span style="color:blue">
      <div class='permalink'>
<a name='p22' class='permalink'></a><p>
	
	
	In their most basic form, streams are similar to lists. The empty stream
	is <kbd>null</kbd>, a non-empty stream is a
	pair, and the <kbd>head</kbd> of the pair is a
	data item. However, the <kbd>tail</kbd> of a
	pair that represents a non-empty stream is not a stream, but a
	<EM>function of no arguments that returns a stream</EM>. The stream
	returned by the function, we call <EM>the tail of the stream</EM>. If we
	have a data item <kbd>x</kbd> and a stream
	<kbd>s</kbd>, we can construct a stream whose
	head is <kbd>x</kbd> and whose tail is
	<kbd>s</kbd> by evaluating
	<kbd>pair(x, () => s)</kbd>.
	
      </p></div>

      <div class='permalink'>
<a name='p23' class='permalink'></a><p>
	In order to access the first data item of a non-empty stream, we just use
	<kbd>head</kbd> as with lists. In order
	to access the tail of a stream
	<kbd>s</kbd>, we need to <EM>apply</EM> 
	<kbd>tail(s)</kbd>, i.e. evaluate
	<kbd>tail(s)()</kbd>. For convenience, we
	therefore define
         
        <div class='snippet' id='javascript_70_26_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=2&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9C9qgDYAKJmy4BKUAG9coOaDYUizen0EiWHTuKHiA3LgC++UVt79hAB37MhAFgA0oXaAC8APlDWqtjE5ceoCREAgLi4XpAA')">function stream_tail(stream) {
    return tail(stream)();
}
</pre></div></div>
        
        
        
	The tail of a stream is <QUOTE>wrapped</QUOTE> in a function. It is a
	<EM>delayed expression</EM>, a <QUOTE>promise</QUOTE> to evaluate an
	expression at some future time.
	Correspondingly, <kbd>stream_tail</kbd>
	<EM>forces</EM>
	
	the tail to fulfill its promise.  It selects the
	<kbd>tail</kbd> of the pair and evaluates the
	delayed expression found there to obtain the next pair of the stream.
        
      </p></div>

      <div class='permalink'>
<a name='p24' class='permalink'></a><p>
        We can make and use streams, in just the same way as we can make
        and use lists, to represent aggregate data arranged in a sequence.  In
        particular, we can build stream analogs of the list operations from
        chapter&nbsp;2, such as  <kbd>list_ref</kbd>,
	<kbd>map</kbd>, and
	<kbd>for_each</kbd>:<a class='superscript' id='footnote-link-8' href='#footnote-8'style="color:blue">[8]</a>
	 
	 
	 
        <div class='snippet' id='javascript_70_27_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9C9qgDYAKJmy4BKUAG9coOaDYUizen0EiWHTuKHiA3LgC++YuWp1GmrtzYERAGlAlJM+QtZKVT0AF4-oAAZZNxDQAH5QAAsOABMRcWDQ+QAuSzEeWw103n5hBnFHegBaUGx9I0JSSlp6US1uTnYAByECR3zpRPdPeioGbhIiATyEpLcIweGupNSm-mZWoWj2OPyC6bGQ3V8APjT6xpa2-es1EfFy41NqizrrAhpmbg4ySNbSdpcuqgJQIT6BkNzp0xoplKpmERWAY3IZQKwBAxWCCkqYlrF4uVQR5wSceA8ni83qZ2lYeGdMTD5MZjLgyHQmKBOABPbh3Ti+UBzKgLAAsjm2Pj23IWGAFkiFTiBFwMMT6TQE7GZWXqmRZbLJjjK5XpJEZ6vZ3AATJzDYchAAPXagK0AalKjgNZPKhoJz3YryEcoYCqVjtZhqN+iAA')">function stream_ref(s, n) {
    return n === 0
           ? head(s)
           : stream_ref(stream_tail(s), n - 1);
}
function stream_map(f, s) {
    return is_null(s)
           ? null
           : pair(f(head(s)),
                  () => stream_map(f, stream_tail(s)));
}
function stream_for_each(fun, s) {
    if (is_null(s)) {
        return true;
    } else {
        fun(head(s));
        return stream_for_each(fun, stream_tail(s));
    }
}
</pre></div></div>
        
	The function
        <kbd>stream_for_each</kbd> is useful for
	viewing streams:
	 
        <div class='snippet' id='javascript_70_28_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9C9qgDYAKJmy4BKUAG9coOaDYUizen0EiWHTuKHiA3LgC++MnSahO7AB7cAJlQYAHAewCeoALygAnAeLlqOlB7JxdXblEtEUkZeVB-Slp6EOc3CM0ubioKVmYNABpQEhjZOPkqAlAhB24SIgFhJnESsvlDUFYBBlZQCqr6D0HQAAYW1rKUsKEAcmnCgCI0Jfn9Utb2zu7pNfG5SbchAAsOWw1mg124-fDIzOzcjTEeNUaKcUL6AFpQbFXd4ziAPk13STyyOTyDEKlhs11WxlwphI5k4NwynE8oEc-DyABZCrpPAA+LE4oQYAmSDwkuoNc64EG3ThCVGgrT6IA')">function display_stream(s) {
    return stream_for_each(display, s);
}
</pre></div></div>
        
      </p></div>

      <div class='permalink'>
<a name='p25' class='permalink'></a><p>
	The function that represents the tail of a stream is evaluated when it
	is accessed, using <kbd>stream_tail</kbd>.
	This design choice is reminiscent of our discussion of rational numbers
	in section&nbsp;<REF NAME="sec:abstraction-barriers"><a class="superscript" id="3.5.1-sec-link-2.1.2" href="./2.1.2.html">2.1.2</a></REF>, where we saw
	that we can choose to implement rational numbers so that the reduction
	of numerator and denominator to lowest terms is performed either at
        construction time or at selection time.  The two rational-number
        implementations produce the same data abstraction, but the choice has
        an effect on efficiency.  There is a similar relationship between
        streams and ordinary lists.  As a data abstraction, streams are the
        same as lists.  The difference is the time at which the elements are
        evaluated.  With ordinary lists, both the
	<kbd>head</kbd> and the
	<kbd>tail</kbd>
        are evaluated at construction time.  With streams, the
	<kbd>tail</kbd> is evaluated at selection time.
      </p></div>

      
      <div class='permalink'>
        <a name='h3' class='permalink'></a><h2>
     
        Streams in action
      </h2></div>

      <div class='permalink'>
<a name='p26' class='permalink'></a><p>
        To see how this data structure behaves, let us analyze the
        <QUOTE>outrageous</QUOTE> prime computation we saw above, reformulated
	in terms of streams:

        <div class='snippet' id='javascript_70_29_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64LmcViWbiG-1kiiqm3B0nmXyGRncJ0u8FQmGcTVu7WR42U6m0zj0kiM63cbD-Uv-R3pytV9wlsul-gN6JAA')">head(stream_tail(stream_filter(
                    is_prime,
                    stream_enumerate_interval(10000, 
                                              1000000))));
</pre></div></div>
        We will see that it does indeed work efficiently.
      </p></div>

      <div class='permalink'>
<a name='p27' class='permalink'></a><p>
        We begin by calling
	<kbd>stream_enumerate_interval</kbd> with
        the arguments 10,000 and 1,000,000.  The function
	<kbd>stream_enumerate_interval</kbd>
        is the stream analog of
	<kbd>enumerate_interval</kbd>
        (section&nbsp;<REF NAME="sec:sequences-conventional-interfaces"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>):
        
	
        <div class='snippet' id='javascript_70_30_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64Q2cUnkynU2mcekkRnW7jYf4x-7haOxmPRIA')">function stream_enumerate_interval(low, high) {
    return low > high
           ? null
           : pair(low,
                  () => stream_enumerate_interval(low + 1, 
                                                  high)); 
}
</pre></div></div>
        and thus the result returned by
	<kbd>stream_enumerate_interval</kbd>,
        formed by the <kbd>pair</kbd>,
	is<a class='superscript' id='footnote-link-9' href='#footnote-9'style="color:blue">[9]</a>
        <div class='snippet' id='javascript_70_31_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64FVq7jYf5B-7hXU-A3Ezik8mU6m0zj0kiM60B4PYcKB4NB-jRIA')">pair(10000, () => stream_enumerate_interval(10001, 1000000));
</pre></div></div>
        That is, <kbd>stream_enumerate_interval</kbd>
        returns a stream represented as a pair whose
	<kbd>head</kbd>
        is 10,000 and whose <kbd>tail</kbd>
	is a promise to enumerate more of the
        interval if so requested.  This stream is now filtered for primes,
        using the stream analog of the <kbd>filter</kbd>
	function
        (section&nbsp;<REF NAME="sec:sequences-conventional-interfaces"><a class="superscript" id="3.5.1-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>):
	 
        <div class='snippet' id='javascript_70_32_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=2&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9C9qgDYAKJmy4BKUAG9coOaDYUizen0EiWHTuKHiA3LgC++MnSahO7AB7cAJlQYAHAewCeoALygAnAeLlqOlB7JxdXblEtEUkZeVB-Slp6EOc3CM0ubioKVmYNABpQEhjZOPkqAlAhB24SIgFhJnESsvlDUFYBBlZQCqr6D0HQAAYW1rKUsKEAcmnCgCI0Jfn9Utb2zu7pNfG5SbchAAsOWw1mg124-fDIzOzcjTEeNUaKcUL6AFpQbFXd4ziAPk13STyyOTyDEKlhs11WxkIpESQVuPAIgghQkcbFshVRYzkimU9BqdQajy04h24wA-EV6gJqa0AFygbGsU7HdinfFUy5yOmOfh5Lk8jLafJM-lyXSeAB8jHF3HRAkx7NxoCl0u1u1RvH4ryezT5-NZepVapxeKVLwpEnhJjMFAsN3FnjZwqEGEKso8CqFVDyADYfZI-R7A0IAOyh+X0hrGgymEjmTjhC25DmgrSeHbmjEPKxxosAUlAACZPENhtDXUaDCDUUI08qCzjsxI9EA')">function stream_filter(pred, stream) {
    return is_null(stream)
           ? null
           : pred(head(stream))
           ? pair(head(stream),
                  () => stream_filter(pred, 
                                      stream_tail(stream)))
           : stream_filter(pred, stream_tail(stream));
}
</pre></div></div>
        
        The function <kbd>stream_filter</kbd> tests the
	<kbd>head</kbd> of the stream (which is 10,000). Since
	this is not prime, <kbd>stream_filter</kbd>
	examines the tail of its input stream.  The call to
	<kbd>stream_tail</kbd> forces evaluation of the
	delayed <kbd>stream_enumerate_interval</kbd>,
	which now returns
        <div class='snippet' id='javascript_70_33_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64FVq7jYf5B7DhXU-A3Ezik8mU6m0zj0kiM60BoP-CLhQNpoP8aJAA')">pair(10001, () => stream_enumerate_interval(10002, 1000000));
</pre></div></div>
	The function <kbd>stream_filter</kbd> now
	looks at the <kbd>head</kbd> of this stream,
        10,001, sees that this is not prime either, forces another 
	<kbd>stream_tail</kbd>, and so on, until 
	<kbd>stream_enumerate_interval</kbd> yields
	the prime 10,007, whereupon
	<kbd>stream_filter</kbd>, according to its
        definition, returns
        <div class='snippet' id='javascript_70_34_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
pair(head(stream), 
     stream_filter(pred, stream_tail(stream)));</pre></div></div>
        which in this case is
        <div class='snippet' id='javascript_70_35_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64FVq7jYf5BgDsmtaup+BuJnFJ5l8hkZ3CdrXBUJhnDDbrEfqcgaDAA5M1nw3qo0byZTqbTOPSSIzrQGg-8AJyO4vtjvTPNN-78fjJ8T99zRIA')">pair(10007,
     () => stream_filter(
               is_prime,
               pair(10008,
                    () => stream_enumerate_interval(10009, 
                                                    1000000))
              )
    );
</pre></div></div>
        This result is now passed to
	<kbd>stream_tail</kbd> in our original
	expression.  This forces the delayed
	<kbd>stream_filter</kbd>, 
	which in turn keeps forcing the delayed
	<kbd>stream_enumerate_interval</kbd> until it
	finds the next prime, which is 10,009.  Finally, the result passed to
	<kbd>head</kbd> in our original expression is
        <div class='snippet' id='javascript_70_36_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE64FVq7jYf5BgCcmtaup+BuJnFJ5l8hkZ3CdrXBUJhnDDbrEfqcgf+gczWfDeqjRvJlOptM49JIjOtAaD2GwjqLrbb0zzQaD-H4yfEvfc0SAA')">pair(10009,
     () => stream_filter(
               is_prime,
               pair(10010,
                    () => stream_enumerate_interval(10011, 
                                                    1000000))
              )
    );
</pre></div></div>
	The function <kbd>head</kbd> returns 10,009, and the
	computation is complete.  Only as many integers were tested for
	primality as were necessary to find the second prime, and the interval
	was enumerated only as far as was necessary to feed the prime filter.
      </p></div>

      <div class='permalink'>
<a name='p28' class='permalink'></a><p>
        In general, we can think of delayed evaluation as 
        
        <QUOTE>demand-driven</QUOTE> programming, whereby each stage in the
	stream process is activated only enough to satisfy the next stage.  What
	we have done is to
        
        decouple the actual order of events in the computation from the apparent
	structure of our functions. We write functions as if the streams existed
	<QUOTE>all at once</QUOTE> when, in reality, the computation is
	performed incrementally, as in traditional programming styles.
      </p></div>


      
      <div class='permalink'>
        <a name='h4' class='permalink'></a><h2>
     
        An optimization
      </h2></div>

      <div class='permalink'>
<a name='p29' class='permalink'></a><p>
	When we construct stream pairs, we delay the evaluation of their tail
	expressions by wrapping these expressions in a function. We force their
	evaluation when needed, by applying the function.
      </p></div>

      <div class='permalink'>
<a name='p30' class='permalink'></a><p>
         
        
        This implementation suffices for streams to work as advertised, but
	there is an important optimization that we shall consider where needed.
	In many	applications, we end up forcing the same delayed object many
	times. This can lead to serious inefficiency in recursive programs
	involving streams.  (See
	exercise&nbsp;<REF NAME="ex:fib-stream-efficiency"><a class="superscript" id="3.5.1-ex-link-3.60" href="./3.5.2.html#ex_3.60">3.60</a></REF>.)
	The solution is to build delayed objects so that the first time they are
	forced, they store the value that is computed.  Subsequent forcings will
	simply return the stored value without repeating the computation.  In
	other words, we implement the construction of stream pairs as a memoized
	function similar to the one described in
	exercise&nbsp;<REF NAME="ex:memoization"><a class="superscript" id="3.5.1-ex-link-3.27" href="./3.3.3.html#ex_3.27">3.27</a></REF>. One way to accomplish this
	is to use the following function, which takes as argument a function
        (of no arguments) and returns a memoized version of the function.
	The first time the memoized function is run, it saves the computed
	result.	On subsequent evaluations, it simply returns
	the result.<a class='superscript' id='footnote-link-10' href='#footnote-10'style="color:blue">[10]</a>
         
        <div class='snippet' id='javascript_70_37_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AWwFMGaAKYkgSlAG8BIUENC5hoADZMKoAIbiATkxkATAJ4B9eaVABeUATkBnJgG5RwydMWGi46XtLKmBKiSbKzYxRSLz6bHh0APj5zMXCxKgJQNgBCOUUVDS1uUIj0iOtbe31SAM8MwtkFJTVNbT0KLVMwosypX3osuwK6oQBfUCZxYzS2+p8-UGaKVrb22vT2swnCUkpaekMARyIZRXUAFgC+oTI6QysmGztdUE3QACpzk0FhWuUqQwAHcRlVNgAiBmyqV6oyDJqHRQID5PIqO5QDQiBRPlwxt5GsNjtkZrh9iRDowWDR1Cs1hsLnpmKw2AT1kwtgjcI8Xm8PqS8RSiQEEaAQKBDAALGgAd0MoG+v1eaDQn1pT1e7zYTPxq0pWzZJg5YGUNGOoBINGkPP5Qp+dj+4jFnyAA')">function memo(fun) {	    
    let already_run = false;
    let result = undefined;
    return () => {
               if (!already_run) {
                   result = fun();
                   already_run = true;
                   return result;
               } else {
                   return result;
               }
           };
}
</pre></div></div>
        
      </p></div>

      <div class='permalink'>
<a name='p31' class='permalink'></a><p>
	We can make use of <kbd>memo</kbd> whenever
	we construct a stream pair. For example, instead of 
         
        <div class='snippet' id='javascript_70_38_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9T9gBwAUBADSMAlKADeuUHNBsKRZvSoNuJIgBstghuNnyj8gPyhNOw8aMAuUP3ZVmwwQAsOAEz3jxIq9YC5QUkAXgA+RhYOHj4hUUi2Lm4KR119HwBuXABffDI6JlBOAE9uJkTOUBD7R2cAFjFgqoiHJ0EMRtCIiy1MvIKKItLy6O4AJir-EaTYwQ81fi12YrESsqiucSzcaZ42AkE13fGxbC2djb3WA6PLk9AzrJBQCndzIk4AI1ZmUAxQNSMVw0ADu9AoIKoZFYuGe3zI7CIDFYLzeDC4KI8rCWxVYHlhYBonwAVqxKACGKACDRmNCPC9IdCgA')">function stream_map(f, s) {
    return is_null(s)
           ? null
           : pair(f(head(s)),
                  () => stream_map(f, stream_tail(s)));
}
</pre></div></div>
	
	we can define an optimized function
	<kbd>stream_map</kbd>	as
	follows:
         
	<div class='snippet' id='javascript_70_39_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AWwFMGaAKYkgSlAG8BIUENC5hoADZMKoAIbiATkxkATAJ4B9eaVABeUATkBnJgG5RwydMWGi46XtLKmBKiSbKzYxRSLz6bHh0APj5zMXCxKgJQNgBCOUUVDS1uUIj0iOtbe31SAM8MwtkFJTVNbT0KLVMwosypX3osuwK6oQBfUCZxYzS2+p8-UGaKVrb22vT2swnCUkpaekMqpQZ1BhkAB3UaTeoGKgAvdw4AGlBDHl5a70bQKkN1EltxNkvJiIB+UGfxcQ-wgAuUCbGRUeQcNgAC1Kby4XFOALqzFYbBigRCy0Saw2212+yOJyR-TaBHOWNW6goYNelx48Jm+DIdGWjA0FJkDF0ILBEIALOcAroQqDwWwMIKMT8XgymSzpAx2StOeoAEy6WocnFbNjKB6bcQyVTnRXqLVcMy4LWaZxsU3W1XnbAWq3KtaKAh2pXYtVOl0gUAUGHShgAIyY8lAGHuhguUJoAHd6BQE1QyExcAHw2QZERekGmBdOYWnIbVO5M2AaKGAFZMSgx-Q0eTp5SB1PpuUkVn2t3qFAasTW3E7PZUA7HZS6-Vlk3e1Yu10+j1es19lB+szWle9n0b0DOswBgsh8OR6MPOOJ+h0cSqUB0TtZ+u5-PBkYP6IEZtkVwAc0rQNg1LI13AfWt62kS8URoQllCAA')">function stream_map_optimized(f, s) {
    return is_null(s)
           ? null
           : pair(f(head(s)),
                  memo( () => stream_map_optimized(
                                 f, stream_tail(s)) ));
}
</pre></div></div>
	
      </p></div>
      
      
    <div class="permalink">
    <a name="ex_3.53" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.53">Exercise 3.53 </a></b> 
  
	
	Declare a function <kbd>stream_map_2</kbd>
	that takes a binary function and two streams as arguments and returns
	a stream whose elements are the results of applying the function
	pairwise to the corresponding elements of the argument streams.
         
	<div class='snippet' id='javascript_70_40_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function stream_map_2(f, s1, s2) {
    ...
}</pre></div></div>
	
	Similar to <kbd>stream_map_optimized</kbd>,
	declare a function
	<kbd>stream_map_2_optimized</kbd> by
	modifying your
	<kbd>stream_map_2</kbd>
	such that the result stream employs memoization.
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_4_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_4_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


      
    <div class="permalink">
    <a name="ex_3.54" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.54">Exercise 3.54 </a></b> 
  
	
	
	Note that our primitive function
	<kbd>display</kbd> returns its argument
	after displaying it.
	What does the interpreter print in response to evaluating each
	statement in the following sequence?<a class='superscript' id='footnote-link-11' href='#footnote-11'style="color:blue">[11]</a>
	<div class='snippet' id='javascript_70_41_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwoCcBTAQwFsB9Vkozq2bsKrblRKjmAN3YAbABRyaAdwA0oABZUA5poCUoAN65QZ0GwpFm9ZStAA+Lbs2nz78wH5Q-OXLce7gBcoAAO7FTMSqpqAYHxZgqGALxOTGxcvPyCwqLikkKyinagANSg2BpxCTW1dQnaevr6ANyguAC++HKsFKAAHqDJjCwcPJzsoQoAJlQMoXLsAJ4a6WNZAkIiYhJSRQoADBrYB80t+GuZbAQK-RoYrRejV6w3d6AA7K1AA')">let x = stream_map(display, stream_enumerate_interval(0, 10));

stream_ref(x, 5);

stream_ref(x, 7);
</pre></div></div>
	What does the interpreter print if 
	<kbd>stream_map_optimized</kbd>
	is used instead of <kbd>stream_map</kbd>?
	<div class='snippet' id='javascript_70_42_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AWwFMGaAKYkgSlAG8BIUENC5hoADZMKoAIbiATkxkATAJ4B9eaVABeUATkBnJgG5RwydMWGi46XtLKmBKiSbKzYxRSLz6bHh0APj5zMXCxKgJQNgBCOUUVDS1uUIj0iOtbe31SAM8MwtkFJTVNbT0KLVMwosypX3osuwK6oQBfUCZxYzS2+p8-UGaKVrb22vT2swnCUkpaekMqpQZ1BhkAB3UaTeoGKgAvdw4AGlBDHl5a70bQKkN1EltxNkvJiIB+UGfxcQ-wgAuUCbGRUeQcNgAC1Kby4XFOALqzFYbBigRCy0Saw2212+yOJyR-TaBHOWNW6goYNelx48Jm+E4CzoFwAjkQZIo2AAPK43BpDHmgABUoB5jLm5GorMMGz+TGW6mUVAAbg8aBDUtcvIL6C4SMplWqNVrzgAmLiM5ky-WuI0q9WGTVsEjnCiKijGp2a-m6wZLDlcphsD1Kx2mnghEjEoTfGN1YERpyGUOe72m87cWOgb5hr0R53yHPAg0Ok1F13u9OFzWgADUoGwVtwExti1AycVbBk5wARn7hLchn3QABSWS6HR6AAMkvbrIe6k28iozFdg6Ew-o9Gnejlckk4YrLu48-mtouKxkayYz2Y8hkHvUrg98lVcjY4hoAHdzlCqAAcyhTdhj1CRf1AEIAOAnN4xeEsQTBCFvz-HN0gCXRMWvW97yYR9n1ffCP1eVCGybc50JJajChgkCrREWZLHFXQr2xdYth2PY10JZQ2HQlVDE2cQZFUckcPUO8iAfJ8mBfEg3xItgZ3ObAZwZXAKRvTRnF5c4MBbLS1kUAg9NAAB2K0gA')">let x = stream_map_optimized(
            display, stream_enumerate_interval(0, 10));
stream_ref(x, 5);
stream_ref(x, 7);
</pre></div></div>
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_5_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_5_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


      
    <div class="permalink">
    <a name="ex_3.55" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_3.55">Exercise 3.55 </a></b> 
  
        
        Consider the sequence of statements
	<div class='snippet' id='javascript_70_43_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=3&prgrm=PTAEGUEkGEAVQFLlAZgHQFY0EYBQuAzAVwDsBjAFwEsB7E0AZwEciBDAJwFMAKADwEpQAb1ygxoLhSLt6vUACpQvANy4AvvmLlqdRgFtWAG0OcGFAPoATKgDcqDGu24lBI8RM5SZoAlRKWrW3tHZwAaUAAmflUNLUpael9-QLsHJxJwilMLa1THV1FxSWl6ZjYubiyzFOD2QQA+UBJC91aAfiaW1vEALlBcqktTSuyatPCXLu7QDqqcoLSp7r6kgIG0sNA5scdQAGpQbGj1QlJ43QGhhm5WcIAjAvdi7zvQAFJQVlAAXl-QAAYYpozjp6PZzAAHdhUPQ8FzCLrPej0X7ffRGEzVdYhFxA07aBKMChcVh6cycEhEWHsVhZcx+LLsGxGbiGGgAd3CAAsqABzLmPIqeEqgNns0CNHn8pbtJpEYwy9x9CGsKhOMWhRXTcTcQTfRpmElkilUzg0ukMs3Mwysjn7Q7hLXa50u13iKUC6KgE7485ghjkmwU5yCsRIprvSI-P6An1kOhmUAGXiBBgQwysACeP1AAE5VHFQf17Oms+ZDZxSdwGKGfCDCdY0xnM+XiZWyVRGdWKBNa+4qARQNxwZTjN3+H3xGpQJxDAxOKAB0OUTHJ91G6XM9wAOTb8IAIjQR-3x2109n84Rbo3ze4XMrlnHp9dN7LFdJ9K777JFFVNrM-ATKAAC0hzPt0GjuJB4ivi236fma1bhMmqabscGi4CYFCMFSOaxr6RasGQZBUnwtYMLhaJyAcFF6KoTzCt4tF4vGJCJvOTA5vBBgQjcxFUuE8EmtStKcPSJCMta3DYOEET-BOqi4KxibZmi8G+IYXbgpwQYZIwnBMMcSkJthABeXFth+GldnI+pKJGGDRmi-yCQZRnwVwBDcJm4QAOxGbBrZGtwpnREAA')">let sum = 0;

function accum(x) {
    sum = x + sum;
    return sum;
}

const seq = stream_map(accum, stream_enumerate_interval(1, 20));

const y = stream_filter(is_even, seq);

const z = stream_filter(x => x % 5 === 0, seq);

stream_ref(y, 7);

display_stream(z);
</pre></div></div>
        What is the value of <kbd>sum</kbd> after each of the
	above statements is evaluated?  What is the printed response to
	evaluating the 
	<kbd>stream_ref</kbd> and 
	<kbd>display_stream</kbd> expressions?
	Would these responses differ if we had applied the function
	<kbd>memo</kbd>
	on every tail of every constructed stream pair, as suggested in the
	optimization above? Explain.
        
      
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_70_6_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_70_6_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

    </span></td></tr></table>
<hr>

    <div class='footnote'>
      <a class='footnote-number' id='footnote-1' href='#footnote-link-1' >[1] </a>
    <FOOTNOTE>
    Assume that we have a
    predicate
    
      <span style="color:green"><kbd>prime?</kbd></span>
      <span style="color:blue"><kbd>is_prime</kbd></span>
    
    (e.g., as in section&nbsp;<REF NAME="sec:primality"><a class="superscript" id="3.5.1-sec-link-1.2.6" href="./1.2.6.html">1.2.6</a></REF>) that
    tests for primality.
    </FOOTNOTE></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-2' href='#footnote-link-2' style="color:green">[2] </a>
    <FOOTNOTE>
    In the MIT
	implementation, 
        
        
        
        <kbd>the-empty-stream</kbd> is the
        same as the empty list <kbd>'()</kbd>, and
	<kbd>stream-null?</kbd> is the same
        as <kbd>null?</kbd>.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-3' href='#footnote-link-3' style="color:green">[3] </a>
    <FOOTNOTE>
    This should bother you.
	The fact that we are defining such similar procedures
        for streams and lists indicates that we are missing some
        underlying abstraction.  Unfortunately, in order to exploit this
        abstraction, we will need to exert finer control over the process of
        evaluation than we can at present.  We will discuss this point further
        at the end of
	section&nbsp;<REF NAME="sec:streams-and-delayed-evaluation"><a class="superscript" id="3.5.1-sec-link-3.5.4" href="./3.5.4.html">3.5.4</a></REF>.
        In section&nbsp;<REF NAME="sec:lazy-evaluation"><a class="superscript" id="3.5.1-sec-link-4.2" href="./4.2.html">4.2</a></REF>, we'll
	develop a framework that unifies lists and streams.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-4' href='#footnote-link-4' style="color:green">[4] </a>
    <FOOTNOTE>
    Although <kbd>stream-car</kbd> and
         
         
        <kbd>stream-cdr</kbd> can be defined as procedures,
	<kbd>cons-stream</kbd> must be a special form.  If
	<kbd>cons-stream</kbd> were a procedure, then,
        according to our model of evaluation, evaluating
	<kbd>(cons-stream ^a^ ^b^)</kbd>
	would automatically cause b to be
	evaluated, which is precisely what we do not want to happen.  For the
	same reason, <kbd>delay</kbd> must be a special form,
	though <kbd>force</kbd> can be an ordinary
	procedure.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-5' href='#footnote-link-5' style="color:green">[5] </a>
    <FOOTNOTE>
    The numbers shown
	here do not really appear in the delayed expression.  What actually
	appears is the original expression, in an environment in which the
	variables are bound to the appropriate numbers.  For example,
	<kbd>(+ low 1)</kbd> with
        <kbd>low</kbd> bound to 10,000 actually appears where
	<kbd>10001</kbd> is shown.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-6' href='#footnote-link-6' style="color:green">[6] </a>
    <FOOTNOTE>
    There are many possible implementations of streams
	other than the one described in this section.  Delayed evaluation, which
	is the key to making streams practical, was inherent in 
        
        
        Algol 60's <EM>call-by-name</EM> parameter-passing method.  The
	use of this mechanism to implement streams was first described by 
        
        Landin (1965). Delayed evaluation for streams was introduced into Lisp by
        
        
        Friedman and Wise (1976). In their implementation,
	<kbd>cons</kbd>
	always delays evaluating its
	arguments, so that lists automatically behave as streams.  The
	memoizing optimization is also known as 
        
        
        
        
        <EM>call-by-need</EM>.  The Algol community would refer to our original
	delayed objects as <EM>call-by-name thunks</EM> and to the optimized
	versions as <EM>call-by-need thunks</EM>.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-7' href='#footnote-link-7' style="color:green">[7] </a>
    <FOOTNOTE>
    Exercises such
	as&nbsp;<REF NAME="ex:delayed1_scheme"><a class="superscript" id="3.5.1-ex-link-3.51" href="./3.5.1.html#ex_3.51">3.51</a></REF>
	and&nbsp;<REF NAME="ex:delayed2_scheme"><a class="superscript" id="3.5.1-ex-link-3.52" href="./3.5.1.html#ex_3.52">3.52</a></REF>
	are valuable for testing our understanding of how
	<kbd>delay</kbd> works. On the other hand, intermixing
	delayed evaluation with printing—and, even worse, with
	assignment—is extremely confusing, and instructors of courses
	on computer languages have traditionally tormented their students with
	examination questions such as the ones in this section.	Needless to say,
	writing programs that depend on such subtleties is
	
	odious programming style.  Part of the power of stream processing is
	that it lets us ignore the order in which events actually happen in
	our programs.  Unfortunately, this is precisely what we cannot afford
	to do in the presence of assignment, which forces us to be concerned
	with time and change.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-8' href='#footnote-link-8' style="color:blue">[8] </a>
    <FOOTNOTE>
    This should
	bother you. The fact that we are defining such similar functions
        for streams and lists indicates that we are missing some underlying
	abstraction.  Unfortunately, in order to exploit this abstraction, we
	will need to exert finer control over the process of evaluation than we
	can at present.  We will discuss this point further at the end of
	section&nbsp;<REF NAME="sec:streams-and-delayed-evaluation"><a class="superscript" id="3.5.1-sec-link-3.5.4" href="./3.5.4.html">3.5.4</a></REF>.
        In section&nbsp;<REF NAME="sec:lazy-evaluation"><a class="superscript" id="3.5.1-sec-link-4.2" href="./4.2.html">4.2</a></REF>, we'll
	develop a framework that unifies lists and streams.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-9' href='#footnote-link-9' style="color:blue">[9] </a>
    <FOOTNOTE>
    The numbers shown here do not really appear in the delayed
	expression.  What actually appears is the original expression, in an
	environment in which the variables are bound to the appropriate numbers.
	For example, <kbd>low + 1</kbd> with
        <kbd>low</kbd> bound to 10,000 actually appears
	where <kbd>10001</kbd> is shown.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-10' href='#footnote-link-10' style="color:blue">[10] </a>
    <FOOTNOTE>
    There are many possible implementations of streams
	other than the one described in this section.  Delayed evaluation, which
	is the key to making streams practical, was inherent in 
        
        
        Algol 60's <EM>call-by-name</EM>
        parameter-passing method.  The use of this mechanism to implement
        streams was first described by 
        
        Landin (1965).  Delayed evaluation for
        streams was introduced into Lisp by 
        
        
        Friedman and Wise (1976). In their
        implementation,
	<kbd>cons</kbd> (the Lisp
	equivalent of our
	<kbd>pair</kbd> function)
	always delays evaluating its arguments, so
        that lists automatically behave as streams.  The memoizing
        optimization is also known as 
        
        
        
        
        <EM>call-by-need</EM>.  The Algol community would refer to our original
	delayed objects as <EM>call-by-name thunks</EM> and to the optimized
	versions as <EM>call-by-need thunks</EM>.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-11' href='#footnote-link-11' style="color:blue">[11] </a>
    <FOOTNOTE>
    Exercises such
	as&nbsp;<REF NAME="ex:delayed1"><a class="superscript" id="3.5.1-ex-link-3.54" href="./3.5.1.html#ex_3.54">3.54</a></REF> and&nbsp;<REF NAME="ex:delayed2"><a class="superscript" id="3.5.1-ex-link-3.55" href="./3.5.1.html#ex_3.55">3.55</a></REF>
	are valuable for testing our understanding of how delayed evaluation
	works. On the other hand, intermixing delayed evaluation with
	printing—and, even worse, with assignment—is extremely
	confusing, and instructors of courses on computer languages have
	traditionally tormented their students with examination questions such
	as the ones in this section. Needless to say, writing programs that
	depend on such subtleties is
	
	odious programming style.  Part of the power of stream processing is
	that it lets us ignore the order in which events actually happen in
	our programs.  Unfortunately, this is precisely what we cannot afford
	to do in the presence of assignment, which forces us to be concerned
	with time and change.
    </FOOTNOTE></span></div>
    
    
</div></div>

    <div class='nav'>
  
        <a class='btn btn-secondary btn-nav' href='./3.5.html'>&lt; Previous</a>
    
    <div style='flex-grow: 1;'></div>
  
        <a class='btn btn-secondary btn-nav' id='72' href='./3.5.2.html'>Next &gt;</a>
      </div>
    <div class='chapter_sign'>
      3.5.1&nbsp;&nbsp;
    Streams Are Delayed Lists
  
    </div>
    <script> var chapter_id = 71; </script>
    <script> var chapter_path = "chapters/3.5.1.html"; </script>
    <div class='next-page'></div>
    </div>
    </div> <!-- /.container -->
    </body></html>