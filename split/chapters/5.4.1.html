<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Global site tag (gtag.js) - Google Analytics - START -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156801664-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-156801664-1');
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics - END -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="description" content="5.4.1&nbsp;&nbsp;
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  " />
    <title>
      5.4.1&nbsp;&nbsp;
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  
    </title>
    
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token" content="EMTEijVc2kiiKUH4nYH0lQG3pLPfMowQ/Stg//t6DCo0e5pWMQwamnTvIdmVZqY/MqSx2IYYE+2bpNV6UNSMwQ==" />

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display?swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" media="all" href="../assets/stylesheet.css" />

   <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico" />

<!--    <link rel="shortcut icon" type="image/png" href="../images/lambda.png" /> -->

    <!-- for support of progressive web app, see github README, DISABLED!
    <link rel="manifest" href="../static/manifest.json">
    -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" 
		     	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	          crossorigin="anonymous">
    </script> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->
    <script type="text/javascript" 
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script>
   <!--  <script type="text/javascript" 
      src="../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script> -->
  
    <script src="../assets/application.js"></script>
  
    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>

    
    <!-- support for progressive web app, see README, DISABLED
    <script>
      if ('serviceWorker' in navigator && !navigator.serviceWorker.controller) {
          navigator.serviceWorker.register("../sw.js").then(function(reg) {
              console.log("Service worker has been registered for scope: " + reg.scope);
          });
      }
    </script>
    -->

     <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top justify-content-between">
       <button id="btn" class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#nav-sidebar" aria-controls="nav-sidebar" aria-expanded="false" aria-label="Toggle navigation" title="navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <span class="navbar-brand-short"><a title="Go back to front page" href="../index.html" class="gray">SICP &mdash; Scheme/JS</a></span>
       <span class="navbar-brand-long" ><a title="Go back to front page" href="../index.html" class="gray">Structure and Interpretation of Computer Programs &mdash; Comparison Edition</a></span>

       <!-- edit the search engine by visiting: 
	    https://cse.google.com/cse/setup/basic?cx=015760785273492757659:nc_tznrzlsg 
	       -->
       <form class="form-inline ml-auto" id="xxx">
         <div id="search-box">
	         <script>
	           (function() {
	               var cx = "015760785273492757659:nc_tznrzlsg";
	               var gcse = document.createElement("script");
	               gcse.type = "text/javascript";
	               gcse.async = true;
	               gcse.src = "https://cse.google.com/cse.js?cx=" + cx;
	               var s = document.getElementsByTagName("script")[0];
	               s.parentNode.insertBefore(gcse, s);
	           })();
	           window.onload = function()
	           { 
	               var searchBox =  document.getElementById("gsc-i-id1");
	               searchBox.placeholder= "search web edition";
	               searchBox.title= "search web edition";
	           }
	         </script>
	         <gcse:search></gcse:search>
         </div>
       </form>
       <span class="navbar-brand-short">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">S</a>
       </span>
       <span class="navbar-brand-long">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">Source</a>
       </span>
     </nav>
     
     <div class="container scroll">

            
        <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
        <!-- insert a dummy entry, to give one extra line of space -->
        <a class="navbar-brand" href="index.html">&nbsp;</a>
    
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-1">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-1" aria-expanded="false" aria-controls="sidebar-collapse-1">
                <a href="./foreword.html"> 
        Foreword
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-2">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-2" aria-expanded="false" aria-controls="sidebar-collapse-2">
                <a href="./prefaces.html"> 
        Prefaces
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-3">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-3" aria-expanded="false" aria-controls="sidebar-collapse-3">
                <a href="./acknowledgements.html"> 
Acknowledgments
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-4">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-4" aria-expanded="false" aria-controls="sidebar-collapse-4">
                <a href="./see.html"> 
    Index Crossreferences (for proofreading)
  </a>
              </span>
            </h5>
          </div>
        </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-5">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.html">1 
    Building Abstractions with 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-5" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-6">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.1.html">1.1 The Elements of Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-6" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-7">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-7" aria-expanded="false" aria-controls="sidebar-collapse-7">
                <a href="./1.1.1.html"> 1.1.1 Expressions</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-8">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-8" aria-expanded="false" aria-controls="sidebar-collapse-8">
                <a href="./1.1.2.html"> 1.1.2 Naming and the Environment</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-9">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-9" aria-expanded="false" aria-controls="sidebar-collapse-9">
                <a href="./1.1.3.html"> 1.1.3 
    Evaluating
    
      <span style="color:green">Combinations</span>
      <span style="color:blue">Operator Combinations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-10">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-10" aria-expanded="false" aria-controls="sidebar-collapse-10">
                <a href="./1.1.4.html"> 1.1.4 
    Compound <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-11">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-11" aria-expanded="false" aria-controls="sidebar-collapse-11">
                <a href="./1.1.5.html"> 1.1.5 
    The Substitution Model for 
    
      <span style="color:green">
        Procedure
      </span>
      <span style="color:blue">
        Function
      </span>
    
    Application
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-12">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-12" aria-expanded="false" aria-controls="sidebar-collapse-12">
                <a href="./1.1.6.html"> 1.1.6 
    Conditional Expressions and Predicates
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-13">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-13" aria-expanded="false" aria-controls="sidebar-collapse-13">
                <a href="./1.1.7.html"> 1.1.7 Example: Square Roots by Newton's Method</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-14">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-14" aria-expanded="false" aria-controls="sidebar-collapse-14">
                <a href="./1.1.8.html"> 1.1.8 
    
      <span style="color:green">
        Procedures
      </span>
      <span style="color:blue">
        Functions
      </span>
    
    as Black-Box Abstractions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-15">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.2.html">1.2 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    and the Processes They Generate
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-15" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-16">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-16" aria-expanded="false" aria-controls="sidebar-collapse-16">
                <a href="./1.2.1.html"> 1.2.1 Linear Recursion and Iteration</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-17">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-17" aria-expanded="false" aria-controls="sidebar-collapse-17">
                <a href="./1.2.2.html"> 1.2.2 Tree Recursion</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-18">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-18" aria-expanded="false" aria-controls="sidebar-collapse-18">
                <a href="./1.2.3.html"> 1.2.3 Orders of Growth</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-19">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-19" aria-expanded="false" aria-controls="sidebar-collapse-19">
                <a href="./1.2.4.html"> 1.2.4 Exponentiation</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-20">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-20" aria-expanded="false" aria-controls="sidebar-collapse-20">
                <a href="./1.2.5.html"> 1.2.5 Greatest Common Divisors</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-21">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-21" aria-expanded="false" aria-controls="sidebar-collapse-21">
                <a href="./1.2.6.html"> 1.2.6 Example: Testing for Primality</a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-22">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.3.html">1.3 
        Formulating Abstractions with Higher-Order 
        
	  <span style="color:green">Procedures</span>
	  <span style="color:blue">Functions</span>
	
      </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-22" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-23">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-23" aria-expanded="false" aria-controls="sidebar-collapse-23">
                <a href="./1.3.1.html"> 1.3.1 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Arguments
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-24">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-24" aria-expanded="false" aria-controls="sidebar-collapse-24">
                <a href="./1.3.2.html"> 1.3.2 
    
      <span style="color:green">Constructing Procedures using Lambda</span>
      <span style="color:blue">Constructing Functions using Lambda Expressions
      </span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-25">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-25" aria-expanded="false" aria-controls="sidebar-collapse-25">
                <a href="./1.3.3.html"> 1.3.3 
    
      <span style="color:green">Procedures</span>
    <span style="color:blue">Functions</span>
    as General Methods
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-26">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-26" aria-expanded="false" aria-controls="sidebar-collapse-26">
                <a href="./1.3.4.html"> 1.3.4 
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
    as Returned Values
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-27">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.html">2 Building Abstractions with Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-27" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-28">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.1.html">2.1 Introduction to Data Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-28" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-29">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-29" aria-expanded="false" aria-controls="sidebar-collapse-29">
                <a href="./2.1.1.html"> 2.1.1 
    Example: Arithmetic Operations for Rational Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-30">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-30" aria-expanded="false" aria-controls="sidebar-collapse-30">
                <a href="./2.1.2.html"> 2.1.2 
    Abstraction Barriers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-31">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-31" aria-expanded="false" aria-controls="sidebar-collapse-31">
                <a href="./2.1.3.html"> 2.1.3 
    What Is Meant by Data?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-32">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-32" aria-expanded="false" aria-controls="sidebar-collapse-32">
                <a href="./2.1.4.html"> 2.1.4 
    Extended Exercise: Interval Arithmetic
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-33">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.2.html">2.2 Hierarchical Data and the Closure Property</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-33" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-34">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-34" aria-expanded="false" aria-controls="sidebar-collapse-34">
                <a href="./2.2.1.html"> 2.2.1 
    Representing Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-35">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-35" aria-expanded="false" aria-controls="sidebar-collapse-35">
                <a href="./2.2.2.html"> 2.2.2 
    Hierarchical Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-36">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-36" aria-expanded="false" aria-controls="sidebar-collapse-36">
                <a href="./2.2.3.html"> 2.2.3 
    Sequences as Conventional Interfaces
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-37">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-37" aria-expanded="false" aria-controls="sidebar-collapse-37">
                <a href="./2.2.4.html"> 2.2.4 
    Example: A Picture Language
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-38">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.3.html">2.3 Symbolic Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-38" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-39">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-39" aria-expanded="false" aria-controls="sidebar-collapse-39">
                <a href="./2.3.1.html"> 2.3.1 
    
      <span style="color:green">Quotation</span>
      <span style="color:blue">Strings</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-40">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-40" aria-expanded="false" aria-controls="sidebar-collapse-40">
                <a href="./2.3.2.html"> 2.3.2 
    Example: Symbolic Differentiation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-41">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-41" aria-expanded="false" aria-controls="sidebar-collapse-41">
                <a href="./2.3.3.html"> 2.3.3 
    Example: Representing Sets
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-42">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-42" aria-expanded="false" aria-controls="sidebar-collapse-42">
                <a href="./2.3.4.html"> 2.3.4 
    Example: Huffman Encoding Trees
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-43">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.4.html">2.4 Multiple Representations for Abstract Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-43" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-44">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-44" aria-expanded="false" aria-controls="sidebar-collapse-44">
                <a href="./2.4.1.html"> 2.4.1 
    Representations for Complex Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-45">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-45" aria-expanded="false" aria-controls="sidebar-collapse-45">
                <a href="./2.4.2.html"> 2.4.2 
    Tagged data
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-46">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-46" aria-expanded="false" aria-controls="sidebar-collapse-46">
                <a href="./2.4.3.html"> 2.4.3 
    Data-Directed Programming and Additivity
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-47">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.5.html">2.5 Systems with Generic Operations</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-47" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-48">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-48" aria-expanded="false" aria-controls="sidebar-collapse-48">
                <a href="./2.5.1.html"> 2.5.1 
    Generic Arithmetic Operations
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-49">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-49" aria-expanded="false" aria-controls="sidebar-collapse-49">
                <a href="./2.5.2.html"> 2.5.2 
    Combining Data of Different Types
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-50">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-50" aria-expanded="false" aria-controls="sidebar-collapse-50">
                <a href="./2.5.3.html"> 2.5.3 
    Example: Symbolic Algebra
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-51">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.html">3 Modularity, Objects, and State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-51" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-52">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.1.html">3.1 Assignment and Local State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-52" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-53">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-53" aria-expanded="false" aria-controls="sidebar-collapse-53">
                <a href="./3.1.1.html"> 3.1.1 
    Local State Variables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-54">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-54" aria-expanded="false" aria-controls="sidebar-collapse-54">
                <a href="./3.1.2.html"> 3.1.2 
    The Benefits of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-55">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-55" aria-expanded="false" aria-controls="sidebar-collapse-55">
                <a href="./3.1.3.html"> 3.1.3 
    The Costs of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-56">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.2.html">3.2 The Environment Model of Evaluation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-56" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-57">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-57" aria-expanded="false" aria-controls="sidebar-collapse-57">
                <a href="./3.2.1.html"> 3.2.1 
    The Rules for Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-58">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-58" aria-expanded="false" aria-controls="sidebar-collapse-58">
                <a href="./3.2.2.html"> 3.2.2 
    Applying Simple
    
      <span style="color:green">Procedures</span>
      <span style="color:blue">Functions</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-59">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-59" aria-expanded="false" aria-controls="sidebar-collapse-59">
                <a href="./3.2.3.html"> 3.2.3 
    Frames as the Repository of Local State
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-60">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-60" aria-expanded="false" aria-controls="sidebar-collapse-60">
                <a href="./3.2.4.html"> 3.2.4 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-61">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.3.html">3.3 Modeling with Mutable Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-61" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-62">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-62" aria-expanded="false" aria-controls="sidebar-collapse-62">
                <a href="./3.3.1.html"> 3.3.1 
    Mutable List Structure
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-63">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-63" aria-expanded="false" aria-controls="sidebar-collapse-63">
                <a href="./3.3.2.html"> 3.3.2 
    Representing Queues
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-64">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-64" aria-expanded="false" aria-controls="sidebar-collapse-64">
                <a href="./3.3.3.html"> 3.3.3 
    Representing Tables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-65">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-65" aria-expanded="false" aria-controls="sidebar-collapse-65">
                <a href="./3.3.4.html"> 3.3.4 
    A Simulator for Digital Circuits
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-66">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-66" aria-expanded="false" aria-controls="sidebar-collapse-66">
                <a href="./3.3.5.html"> 3.3.5 
    Propagation of Constraints
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-67">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.4.html">3.4 Concurrency: Time Is of the Essence</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-67" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-68">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-68" aria-expanded="false" aria-controls="sidebar-collapse-68">
                <a href="./3.4.1.html"> 3.4.1 
    The Nature of Time in Concurrent Systems
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-69">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-69" aria-expanded="false" aria-controls="sidebar-collapse-69">
                <a href="./3.4.2.html"> 3.4.2 
    Mechanisms for Controlling Concurrency
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-70">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.5.html">3.5 Streams</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-70" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-71">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-71" aria-expanded="false" aria-controls="sidebar-collapse-71">
                <a href="./3.5.1.html"> 3.5.1 
    Streams Are Delayed Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-72">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-72" aria-expanded="false" aria-controls="sidebar-collapse-72">
                <a href="./3.5.2.html"> 3.5.2 
    Infinite Streams
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-73">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-73" aria-expanded="false" aria-controls="sidebar-collapse-73">
                <a href="./3.5.3.html"> 3.5.3 
    Exploiting the Stream Paradigm
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-74">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-74" aria-expanded="false" aria-controls="sidebar-collapse-74">
                <a href="./3.5.4.html"> 3.5.4 
    Streams and Delayed Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-75">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-75" aria-expanded="false" aria-controls="sidebar-collapse-75">
                <a href="./3.5.5.html"> 3.5.5 
    Modularity of Functional Programs and Modularity of Objects
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-76">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.html">4 Metalinguistic Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-76" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-77">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.1.html">4.1 The Metacircular Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-77" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-78">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-78" aria-expanded="false" aria-controls="sidebar-collapse-78">
                <a href="./4.1.1.html"> 4.1.1 
    The Core of the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-79">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-79" aria-expanded="false" aria-controls="sidebar-collapse-79">
                <a href="./4.1.2.html"> 4.1.2 
    Representing
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-80">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-80" aria-expanded="false" aria-controls="sidebar-collapse-80">
                <a href="./4.1.3.html"> 4.1.3 
    Evaluator Data Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-81">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-81" aria-expanded="false" aria-controls="sidebar-collapse-81">
                <a href="./4.1.4.html"> 4.1.4 
    Running the Evaluator as a Program
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-82">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-82" aria-expanded="false" aria-controls="sidebar-collapse-82">
                <a href="./4.1.5.html"> 4.1.5 
    Data as Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-83">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-83" aria-expanded="false" aria-controls="sidebar-collapse-83">
                <a href="./4.1.6.html"> 4.1.6 
    Internal
    
      <span style="color:green">Definitions</span>
      <span style="color:blue">Declarations</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-84">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-84" aria-expanded="false" aria-controls="sidebar-collapse-84">
                <a href="./4.1.7.html"> 4.1.7 
    Separating Syntactic Analysis from Execution
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-85">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.2.html">4.2 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Lazy Evaluation
</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-85" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-86">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-86" aria-expanded="false" aria-controls="sidebar-collapse-86">
                <a href="./4.2.1.html"> 4.2.1 
    Normal Order and Applicative Order
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-87">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-87" aria-expanded="false" aria-controls="sidebar-collapse-87">
                <a href="./4.2.2.html"> 4.2.2 
    An Interpreter with Lazy Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-88">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-88" aria-expanded="false" aria-controls="sidebar-collapse-88">
                <a href="./4.2.3.html"> 4.2.3 
    Streams as Lazy Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-89">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.3.html">4.3 
    
      <span style="color:green">Variations on a Scheme:</span>
    
    Nondeterministic Computing
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-89" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-90">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-90" aria-expanded="false" aria-controls="sidebar-collapse-90">
                <a href="./4.3.1.html"> 4.3.1 
    
      <span style="color:green">Amb and Search</span>
      <span style="color:blue">Search and amb</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-91">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-91" aria-expanded="false" aria-controls="sidebar-collapse-91">
                <a href="./4.3.2.html"> 4.3.2 
    Examples of Nondeterministic Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-92">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-92" aria-expanded="false" aria-controls="sidebar-collapse-92">
                <a href="./4.3.3.html"> 4.3.3 
    Implementing the
    
      <span style="color:green">Amb</span>
      <span style="color:blue">amb</span>
    
    Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-93">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.4.html">4.4 Logic Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-93" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-94">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-94" aria-expanded="false" aria-controls="sidebar-collapse-94">
                <a href="./4.4.1.html"> 4.4.1 
    Deductive Information Retrieval
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-95">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-95" aria-expanded="false" aria-controls="sidebar-collapse-95">
                <a href="./4.4.2.html"> 4.4.2 
    How the Query System Works
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-96">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-96" aria-expanded="false" aria-controls="sidebar-collapse-96">
                <a href="./4.4.3.html"> 4.4.3 
    Is Logic Programming Mathematical Logic?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-97">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-97" aria-expanded="false" aria-controls="sidebar-collapse-97">
                <a href="./4.4.4.html"> 4.4.4 
    Implementing the Query System
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-98">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.html">5 Computing with Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-98" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-99">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.1.html">5.1 Designing Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-99" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-100">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-100" aria-expanded="false" aria-controls="sidebar-collapse-100">
                <a href="./5.1.1.html"> 5.1.1 
    A Language for Describing Register Machines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-101">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-101" aria-expanded="false" aria-controls="sidebar-collapse-101">
                <a href="./5.1.2.html"> 5.1.2 
    Abstraction in Machine Design
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-102">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-102" aria-expanded="false" aria-controls="sidebar-collapse-102">
                <a href="./5.1.3.html"> 5.1.3 
    Subroutines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-103">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-103" aria-expanded="false" aria-controls="sidebar-collapse-103">
                <a href="./5.1.4.html"> 5.1.4 
    Using a Stack to Implement Recursion
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-104">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-104" aria-expanded="false" aria-controls="sidebar-collapse-104">
                <a href="./5.1.5.html"> 5.1.5 
    Instruction Summary
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-105">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.2.html">5.2 A Register-Machine Simulator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-105" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-106">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-106" aria-expanded="false" aria-controls="sidebar-collapse-106">
                <a href="./5.2.1.html"> 5.2.1 
    The Machine Model
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-107">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-107" aria-expanded="false" aria-controls="sidebar-collapse-107">
                <a href="./5.2.2.html"> 5.2.2 
    The Assembler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-108">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-108" aria-expanded="false" aria-controls="sidebar-collapse-108">
                <a href="./5.2.3.html"> 5.2.3 
    
      <span style="color:green">Generating Execution Procedures for Instructions</span>
      <span style="color:blue">Instructions and their Execution Functions</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-109">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-109" aria-expanded="false" aria-controls="sidebar-collapse-109">
                <a href="./5.2.4.html"> 5.2.4 
    Monitoring Machine Performance
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-110">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.3.html">5.3 Storage Allocation and Garbage Collection</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-110" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-111">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-111" aria-expanded="false" aria-controls="sidebar-collapse-111">
                <a href="./5.3.1.html"> 5.3.1 
    Memory as Vectors
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-112">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-112" aria-expanded="false" aria-controls="sidebar-collapse-112">
                <a href="./5.3.2.html"> 5.3.2 
    Maintaining the Illusion of Infinite Memory
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-113">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.4.html">5.4 The Explicit-Control Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-113" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-114">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-114" aria-expanded="false" aria-controls="sidebar-collapse-114">
                <a href="./5.4.1.html"> 5.4.1 
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-115">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-115" aria-expanded="false" aria-controls="sidebar-collapse-115">
                <a href="./5.4.2.html"> 5.4.2 
        Evaluating function applications
      </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-116">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-116" aria-expanded="false" aria-controls="sidebar-collapse-116">
                <a href="./5.4.3.html"> 5.4.3 
    
      <span style="color:green">
        Conditionals, Assignments and Definitions
      </span>
      <span style="color:blue">
        Blocks, Assignments, and Declarations
      </span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-117">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-117" aria-expanded="false" aria-controls="sidebar-collapse-117">
                <a href="./5.4.4.html"> 5.4.4 
    Running the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-118">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.5.html">5.5 Compilation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-118" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-119">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-119" aria-expanded="false" aria-controls="sidebar-collapse-119">
                <a href="./5.5.1.html"> 5.5.1 
    Structure of the Compiler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-120">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-120" aria-expanded="false" aria-controls="sidebar-collapse-120">
                <a href="./5.5.2.html"> 5.5.2 
    Compiling
    
      <span style="color:green">Expressions</span>
      <span style="color:blue">Components</span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-121">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-121" aria-expanded="false" aria-controls="sidebar-collapse-121">
                <a href="./5.5.3.html"> 5.5.3 
    Compiling
    
      <span style="color:green">
	Combinations
      </span>
      <span style="color:blue">
	Applications
      </span>
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-122">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-122" aria-expanded="false" aria-controls="sidebar-collapse-122">
                <a href="./5.5.4.html"> 5.5.4 
    Combining Instruction Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-123">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-123" aria-expanded="false" aria-controls="sidebar-collapse-123">
                <a href="./5.5.5.html"> 5.5.5 
    An Example of Compiled Code
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-124">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-124" aria-expanded="false" aria-controls="sidebar-collapse-124">
                <a href="./5.5.6.html"> 5.5.6 
    Lexical Addressing
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-125">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-125" aria-expanded="false" aria-controls="sidebar-collapse-125">
                <a href="./5.5.7.html"> 5.5.7 
    Interfacing Compiled Code to the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-126">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-126" aria-expanded="false" aria-controls="sidebar-collapse-126">
                <a href="./references.html"> References</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-127">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-127" aria-expanded="false" aria-controls="sidebar-collapse-127">
                <a href="./making-of.html"> About the SICP JS Project</a>
              </span>
            </h5>
          </div>
        </div>
        </div>
<div id='permalink-msg'>
<div class='screen'>
  <div class='alert alert-success'>
    <strong>Permalink copied!</strong>
  </div>
</div>
</div>
<div class='chapter-content'>

      <div class='chapter-title'>
        <div class='permalink'>
        <a name='top' class='permalink'> 
    5.4.1&nbsp;&nbsp;
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  
        </a>
        </div>
      </div>
      <div class='chapter-text'>
        <div class='SECTION'>
    

  
  
    <span style="color:green">
      
    </span>
    <span style="color:blue">
      
    </span>
  

  <div class='permalink'>
<a name='p1' class='permalink'></a><p>
    The central element in the evaluator is the sequence of instructions beginning at
    
      <span style="color:green"><kbd>eval-dispatch</kbd>.</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>. </span>
    
    This corresponds to the
    
      <span style="color:green"><kbd>eval</kbd></span>
      <span style="color:blue"><kbd>evaluate</kbd></span>
    
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    of the metacircular evaluator described in section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="5.4.1-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF>. When the controller starts at
    
      <span style="color:green"><kbd>eval-dispatch</kbd>,</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>,
      </span>
    
    it evaluates the 
    <span style="color:green">expression</span><span style="color:blue">component</span>
    specified by
    
      <span style="color:green"><kbd>exp</kbd></span>
      <span style="color:blue"><kbd>comp</kbd></span>
    
    in the environment specified by <kbd>env</kbd>. When evaluation is
    complete, the controller will go to the entry point stored in
    <kbd>continue</kbd>, and the <kbd>val</kbd>
    register will hold the value of the
    <span style="color:green">expression.</span><span style="color:blue">component.</span>
    As with the metacircular
    
      <span style="color:green"><kbd>eval</kbd>,</span>
      <span style="color:blue"><kbd>evaluate</kbd>,</span>
    
    the structure of
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>
      </span>
    
    is a case analysis on the syntactic type of the
    <span style="color:green">expression</span><span style="color:blue">component</span>
    to be evaluated.<a class='superscript' id='footnote-link-1' href='#footnote-1'>[1]</a>
   
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_1_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
eval-dispatch
(test (op self-evaluating?) (reg exp))
(branch (label ev-self-eval))
(test (op variable?) (reg exp))
(branch (label ev-variable))
(test (op quoted?) (reg exp))
(branch (label ev-quoted))
(test (op assignment?) (reg exp))
(branch (label ev-assignment))
(test (op definition?) (reg exp))
(branch (label ev-definition))
(test (op if?) (reg exp))
(branch (label ev-if))
(test (op lambda?) (reg exp))
(branch (label ev-lambda))
(test (op begin?) (reg exp))
(branch (label ev-begin))
(test (op application?) (reg exp))
(branch (label ev-application))
(goto (label unknown-expression-type))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_1_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"eval_dispatch",
  test(list(op("is_literal"), reg("comp"))),
  branch(label("ev_literal")),
  test(list(op("is_name"), reg("comp"))),
  branch(label("ev_name")),
  test(list(op("is_application"), reg("comp"))),
  branch(label("ev_application")),
  test(list(op("is_operator_combination"), reg("comp"))),
  branch(label("ev_operator_combination")),
  test(list(op("is_conditional"), reg("comp"))),
  branch(label("ev_conditional")),
  test(list(op("is_lambda_expression"), reg("comp"))),
  branch(label("ev_lambda")),
  test(list(op("is_sequence"), reg("comp"))),
  branch(label("ev_sequence")),
  test(list(op("is_block"), reg("comp"))),
  branch(label("ev_block")),
  test(list(op("is_return_statement"), reg("comp"))),
  branch(label("ev_return")),
  test(list(op("is_function_declaration"), reg("comp"))),
  branch(label("ev_function_declaration")),
  test(list(op("is_declaration"), reg("comp"))),
  branch(label("ev_declaration")),
  test(list(op("is_assignment"), reg("comp"))),
  branch(label("ev_assignment")),
  go_to(label("unknown_component_type")),</pre></div></div></td></tr></table>
  </p></div>

  
      <div class='permalink'>
        <a name='h1' class='permalink'></a><h2>
    
    Evaluating simple expressions
  </h2></div>

  
    <span style="color:green">
      
    </span>
    <span style="color:blue">
      
    </span>
  

  <div class='permalink'>
<a name='p2' class='permalink'></a><p>
    Numbers and strings<span style="color:green"> (which are self-evaluating)</span>,
    
      <span style="color:green">variables, quotations,</span>
      <span style="color:blue">names,</span>
    
    and
    
      <span style="color:green"><kbd>lambda</kbd></span>
      <span style="color:blue">lambda</span>
    
    expressions have no subexpressions to be evaluated. For these, the evaluator simply
    places the correct value in the <kbd>val</kbd> register and
    continues execution at the entry point specified by
    <kbd>continue</kbd>. Evaluation of simple expressions is performed
    by the following controller code:
     
     
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_2_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-self-eval
(assign val (reg exp))
(goto (reg continue))
ev-variable
(assign val (op lookup-variable-value) (reg exp) (reg env))
(goto (reg continue))
ev-quoted
(assign val (op text-of-quotation) (reg exp))
(goto (reg continue))
ev-lambda
(assign unev (op lambda-parameters) (reg exp))
(assign exp (op lambda-body) (reg exp))
(assign val (op make-procedure)
(reg unev) (reg exp) (reg env))
(goto (reg continue))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_2_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_literal",
  assign("val", list(op("literal_value"), reg("comp"))),
  go_to(reg("continue")),

"ev_name",
  assign("val", list(op("symbol_of_name"), reg("comp"), reg("env"))),
  assign("val", list(op("lookup_symbol_value"), reg("val"), reg("env"))),
  go_to(reg("continue")),
      
"ev_lambda",
  assign("unev", list(op("lambda_parameter_symbols"), reg("comp"))),
  assign("comp", list(op("lambda_body"), reg("comp"))),
  assign("val", list(op("make_function"),
                     reg("unev"), reg("comp"), reg("env"))),
  go_to(reg("continue")),</pre></div></div></td></tr></table>
    Observe how
    
      <span style="color:green"><kbd>ev-lambda</kbd></span>
      <span style="color:blue"><kbd>ev_lambda</kbd></span>
    
    uses the
    
      <span style="color:green"><kbd>unev</kbd></span>
      <span style="color:blue"><kbd>unev</kbd></span>
    
    and
    
      <span style="color:green"><kbd>exp</kbd></span>
      <span style="color:blue"><kbd>comp</kbd></span>
    
    registers to hold the parameters and body of the lambda expression so
    that they can be passed to the
    
      <span style="color:green"><kbd>make-procedure</kbd></span>
      <span style="color:blue"><kbd>make_function</kbd>
    </span>
    operation, along with the environment in <kbd>env</kbd>.
    
      <span style="color:green">
	      
      </span>
      <span style="color:blue">
	      
      </span>
    
  </p></div>

  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
  
      <div class='permalink'>
        <a name='h2' class='permalink'></a><h2>
     
    
      
        <span style="color:green">Evaluating procedure applications</span>
        <span style="color:blue">Evaluating function applications and operator combinations</span>
      
    
  </h2></div>

  
    <span style="color:green">
      
      
    </span>
    <span style="color:blue">
      
      
    </span>
  

  <div class='permalink'>
<a name='p3' class='permalink'></a><p>
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
	A procedure application is specified by a combination containing an
  
    <span style="color:green">operator</span>
    <span style="color:blue">function expression</span>
  
  and
  
    <span style="color:green">operands</span>
    <span style="color:blue">argument expressions</span>
  .
	The
  
    <span style="color:green">operator</span>
    <span style="color:blue">function expression</span>
  
  is a subexpression whose value is a
	procedure, and the 
  
    <span style="color:green">operands</span>
    <span style="color:blue">argument expressions</span>
  
  are subexpressions whose values are the
	arguments to which the procedure
	should be applied.
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
	A function application is specified by a combination containing
	a function expression and argument expressions.
	The function expression is a subexpression whose value is a function,
	and the argument expressions are subexpressions whose values are the
	arguments to which the function
	should be applied.
      </span></td></tr></table>
    The metacircular
    
      <span style="color:green"><kbd>eval</kbd></span>
      <span style="color:blue"><kbd>evaluate</kbd></span>
    
    handles applications by calling itself recursively to
    evaluate each element of the combination, and then passing the results
    to <kbd>apply</kbd>, which performs the actual
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    application.  The
    explicit-control evaluator does the same thing; these recursive calls
    are implemented by
    
      <span style="color:green">
	<kbd>goto</kbd>
      </span>
      <span style="color:blue">
	<kbd>go_to</kbd>
      </span>
    
    instructions, together with 
    
    use of the stack to save registers that will be restored after the recursive
    call returns.  Before each call we will be careful to identify which
    registers must be saved (because their values will be needed
    later).<a class='superscript' id='footnote-link-2' href='#footnote-2'style="color:green">[2]</a>
  </p></div>

  <div class='permalink'>
<a name='p4' class='permalink'></a><p>
    As in the metacircular evaluator, operator combinations
    are transformed into applications of primitive functions
    corresponding to the operators. This takes place at <kbd>ev_operator_combination</kbd>,
    which performs this transformation in place in <kbd>comp</kbd> and falls through to
    <kbd>ev_application</kbd>. 
  </p></div>

  <div class='permalink'>
<a name='p5' class='permalink'></a><p>
    We begin the evaluation of an application by evaluating the
    
      <span style="color:green">
	operator
      </span>
      <span style="color:blue">
	function expression
      </span>
    
    to produce a
    
      <span style="color:green">procedure,</span>
      <span style="color:blue">function,</span>
    
    which will later be applied to the evaluated
    
      <span style="color:green">
	operands.
      </span>
      <span style="color:blue">
	argument expressions.
      </span>
    
    To evaluate the
    
      <span style="color:green">
	operator,
      </span>
      <span style="color:blue">
	function expression,
      </span>
    
    we move it to the 
    
      <span style="color:green"><kbd>exp</kbd></span>
      <span style="color:blue"><kbd>comp</kbd></span>
    
    register and go to
    
      <span style="color:green"><kbd>eval-dispatch</kbd>.</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>.
      </span>
    
    The environment in the <kbd>env</kbd> register is already
    the correct one in which to evaluate the
    
      <span style="color:green">operator.</span>
      <span style="color:blue">function expression.</span>
    
    However, we save <kbd>env</kbd> because we will need it
    later to evaluate the
    
      <span style="color:green">
	operands.
      </span>
      <span style="color:blue">
	argument expressions.
      </span>
    
    We also extract the
    
      <span style="color:green">
	operands
      </span>
      <span style="color:blue">
	argument expressions
      </span>
    
    into <kbd>unev</kbd> and save this on the stack.  We set
    up <kbd>continue</kbd> so that
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue">
	<kbd>eval_dispatch</kbd>
      </span>
    
    will resume at
    
      <span style="color:green"><kbd>ev-appl-did-operator</kbd></span>
      <span style="color:blue">
	<kbd>ev_appl_did_function_expression</kbd>
      </span>
    
    after the
    
      <span style="color:green">
	operator
      </span>
      <span style="color:blue">
	function expression
      </span>
    
    has been evaluated.  First, however, we save the old value of
    <kbd>continue</kbd>, which tells the controller where to
    continue after the application.
     
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_3_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-application
(save continue)
(save env)
(assign unev (op operands) (reg exp))
(save unev)
(assign exp (op operator) (reg exp))
(assign continue (label ev-appl-did-operator))
(goto (label eval-dispatch))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_3_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_operator_combination",
      assign("comp", list(op("operator_combination_to_application"),
                          reg("comp"), reg("env"))),
"ev_application",
      save("continue"),
      save("env"),
      assign("unev", list(op("arg_expressions"), reg("comp"))),
      save("unev"),
      assign("comp", list(op("function_expression"), reg("comp"))),
      assign("continue", label("ev_appl_did_function_expression")),
      go_to(label("eval_dispatch")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p6' class='permalink'></a><p>
    
      <span style="color:green">
	
      </span>
      <span style="color:blue">
	
      </span>
    
    Upon returning from evaluating the
    
      <span style="color:green">
	operator subexpression,
      </span>
      <span style="color:blue">
	function expression,
      </span>
    
    we proceed
    to evaluate the
    
      <span style="color:green">
	operands
      </span>
      <span style="color:blue">
	argument expressions
      </span>
    
    of the
    
      <span style="color:green">combination</span>
      <span style="color:blue">application</span>
    
    and to accumulate the
    resulting arguments in a list, held in <kbd>argl</kbd>.
    First we restore the unevaluated
    
      <span style="color:green">
	operands
      </span>
      <span style="color:blue">
	argument expressions
      </span>
    
    and the environment.  We
    initialize <kbd>argl</kbd> to an empty list.  Then we
    assign to the
    
      <span style="color:green">
	<kbd>proc</kbd>
      </span>
      <span style="color:blue">
	<kbd>fun</kbd>
      </span>
    
    register the
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    that was produced by evaluating the
    
      <span style="color:green">
	operator.
      </span>
      <span style="color:blue">
	function expression.
      </span>
    
    If there are
    no
    
      <span style="color:green">
	operands,
      </span>
      <span style="color:blue">
	argument expressions,
      </span>
    
    we go directly to
    
      <span style="color:green"><kbd>apply-dispatch</kbd>.</span>
      <span style="color:blue"><kbd>apply_dispatch</kbd>.
      </span>
    
    Otherwise we save
    
      <span style="color:green">
	<kbd>proc</kbd>
      </span>
      <span style="color:blue">
	<kbd>fun</kbd>
      </span>
    
    on the stack and start the argument-evaluation
    loop:<a class='superscript' id='footnote-link-3' href='#footnote-3'style="color:green">[3]</a>
  <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_4_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-appl-did-operator
(restore unev)                  ; the operands
(restore env)
(assign argl (op empty-arglist))
(assign proc (reg val))         ; the operator
(test (op no-operands?) (reg unev))
(branch (label apply-dispatch))
(save proc)</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_4_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_appl_did_function_expression",
      restore("unev"), // the argument expressions
      restore("env"),
      assign("argl", list(op("empty_arglist"))),
      assign("fun", reg("val")), // the function
      test(list(op("is_null"), reg("unev"))),
      branch(label("apply_dispatch")),
      save("fun"),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p7' class='permalink'></a><p>
    Each cycle of the argument-evaluation loop evaluates an 
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    from the list in <kbd>unev</kbd> and accumulates the
    result into <kbd>argl</kbd>. To evaluate an
  
    <span style="color:green">operand,</span>
    <span style="color:blue">argument expression,</span>
  
    we place it in the 
    
      <span style="color:green"><kbd>exp</kbd></span>
      <span style="color:blue"><kbd>comp</kbd></span>
    
    register and go to
    
      <span style="color:green"><kbd>eval-dispatch</kbd>,</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>,
      </span>
    
    after setting <kbd>continue</kbd> so that execution will
    resume with the argument-accumulation phase.  But first we save the
    arguments accumulated so far (held in <kbd>argl</kbd>), the
    environment (held in <kbd>env</kbd>), and the remaining
    
      <span style="color:green">operands</span>
      <span style="color:blue">argument expressions
      </span>
    
    to be evaluated (held in <kbd>unev</kbd>).  A special case
    is made for the evaluation of the last
    
      <span style="color:green">operand</span>
      <span style="color:blue">argument expression,</span>
    
    which is handled at
    
      <span style="color:green"><kbd>ev-appl-last-arg</kbd>.</span>
      <span style="color:blue"><kbd>ev_appl_last_arg</kbd>.
      </span>
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_5_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-appl-operand-loop
(save argl)
(assign exp (op first-operand) (reg unev))
(test (op last-operand?) (reg unev))
(branch (label ev-appl-last-arg))
(save env)
(save unev)
(assign continue (label ev-appl-accumulate-arg))
(goto (label eval-dispatch))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_5_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_appl_argument_expression_loop",
      save("argl"),
      assign("comp", list(op("head"), reg("unev"))),
      test(list(op("is_last_argument_expression"),
                reg("unev"))),
      branch(label("ev_appl_last_arg")),
      save("env"),
      save("unev"),
      assign("continue", label("ev_appl_accumulate_arg")),
      go_to(label("eval_dispatch")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p8' class='permalink'></a><p>
    When an
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    has been evaluated, the value is accumulated into the list
    held in <kbd>argl</kbd>.  The
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    is then removed from
    the list of unevaluated
  
    <span style="color:green">operands</span>
    <span style="color:blue">argument expressions</span>
  
    in <kbd>unev</kbd>, and
    the argument-evaluation loop continues.
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_6_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-appl-accumulate-arg
(restore unev)
(restore env)
(restore argl)
(assign argl (op adjoin-arg) (reg val) (reg argl))
(assign unev (op rest-operands) (reg unev))
(goto (label ev-appl-operand-loop))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_6_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_appl_accumulate_arg",
      restore("unev"),
      restore("env"),
      restore("argl"),
      assign("argl", list(op("adjoin_arg"),
                          reg("val"), reg("argl"))),
      assign("unev", list(op("tail"), reg("unev"))),
      go_to(label("ev_appl_argument_expression_loop")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p9' class='permalink'></a><p>
    Evaluation of the last argument <span style="color:blue">expression</span> is handled differently.  There is no
    need to save the environment or the list of unevaluated 
  
    <span style="color:green">operands</span>
    <span style="color:blue">argument expressions</span>
  
    before going to
    
      <span style="color:green"><kbd>eval-dispatch</kbd>,</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>,
      </span>
    
    since they will not be required after the last
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    is evaluated.
    Thus, we return from the evaluation to a special entry point
    
      <span style="color:green"><kbd>ev-appl-accum-last-arg</kbd>,</span>
      <span style="color:blue"><kbd>ev_appl_accum_last_arg</kbd>,
      </span>
    
    which restores the argument list, accumulates the new argument, restores the
    saved
    
      <span style="color:green">procedure,</span>
      <span style="color:blue">function,</span>
    
    and goes off to perform the application.<a class='superscript' id='footnote-link-4' href='#footnote-4'style="color:green">[4]</a>
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_7_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-appl-last-arg
(assign continue (label ev-appl-accum-last-arg))
(goto (label eval-dispatch))
ev-appl-accum-last-arg
(restore argl)
(assign argl (op adjoin-arg) (reg val) (reg argl))
(restore proc)
(goto (label apply-dispatch))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_7_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_appl_last_arg",
      assign("continue", label("ev_appl_accum_last_arg")),
      go_to(label("eval_dispatch")),
      
"ev_appl_accum_last_arg",
      restore("argl"),
      assign("argl", list(op("adjoin_arg"),
                          reg("val"), reg("argl"))),
      restore("fun"),
      go_to(label("apply_dispatch")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p10' class='permalink'></a><p>
    
    The details of the argument-evaluation loop determine the order in
    which the interpreter evaluates the
  
    <span style="color:green">operands</span>
    <span style="color:blue">argument expressions</span>
  
    of a combination (e.g.,
    left to right or right to left—see
    exercise&nbsp;<REF NAME="ex:order-of-evaluation"><a class="superscript" id="5.4.1-ex-link-3.8" href="./3.1.3.html#ex_3.8">3.8</a></REF>).  This order is not
    determined by the metacircular evaluator, which inherits its control
    structure from the underlying <span style="color:green">Scheme</span><span style="color:blue">JavaScript</span> in which it
    is implemented.<a class='superscript' id='footnote-link-5' href='#footnote-5'style="color:green">[5]</a>
    
    
      <span style="color:green">
        Because the <kbd>first-operand</kbd> selector (used in
        <kbd>ev-appl-operand-loop</kbd> to extract successive
        operands from <kbd>unev</kbd>) is implemented as
        <kbd>car</kbd> and the
        <kbd>rest-operands</kbd> selector is implemented as
        <kbd>cdr</kbd>, the explicit-control evaluator will
        evaluate the operands of a combination in left-to-right order.
      </span>
      <span style="color:blue">
        Because we use <kbd>head</kbd> and
        <kbd>tail</kbd> to extract successive operands
        from <kbd>unev</kbd> the explicit-control
        evaluator will evaluate the argument expressions of a combination in
        left-to-right order. 
      </span>
    
    
      <span style="color:green">
	
      </span>
      <span style="color:blue">
	
      </span>
    
  </p></div>

  
      <div class='permalink'>
        <a name='h3' class='permalink'></a><h2>
     
    
      
	<span style="color:green">Procedure</span>
	<span style="color:blue">Function</span>
      
    application
  </h2></div>

  
  <div class='permalink'>
<a name='p11' class='permalink'></a><p>
    The entry point
    
      <span style="color:green">
      <kbd>apply-dispatch</kbd></span>
      <span style="color:blue"><kbd>apply_dispatch</kbd>
      </span>
    
    corresponds to the <kbd>apply</kbd>
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    of the metacircular evaluator.  By the time we get to
    
      <span style="color:green"><kbd>apply-dispatch</kbd>,</span>
      <span style="color:blue"><kbd>apply_dispatch</kbd>,
      </span>
    
    the
    
      <span style="color:green">
	<kbd>proc</kbd>
      </span>
      <span style="color:blue">
	<kbd>fun</kbd>
      </span>
    
    register contains the
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    to apply and <kbd>argl</kbd> contains the list of
    evaluated arguments to which it must be applied.  The saved value of
    <kbd>continue</kbd> (originally passed to
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>
      </span>
    
    and saved at
    
      <span style="color:green"><kbd>ev-application</kbd>),</span>
      <span style="color:blue"><kbd>ev_application</kbd>),
      </span>
    
    which tells where to return with the result of the
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    application, is on the stack.  When the application is complete, the
    controller transfers to the entry point specified by the saved
    <kbd>continue</kbd>, with the result of the application in
    <kbd>val</kbd>.  As with the metacircular
    <kbd>apply</kbd>, there are two cases to consider.  Either
    the
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    to be applied is a primitive or it is a compound
    
      <span style="color:green">procedure.</span>
      <span style="color:blue">function.</span>
    
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_8_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
apply-dispatch
(test (op primitive-procedure?) (reg proc))
(branch (label primitive-apply))
(test (op compound-procedure?) (reg proc))  
(branch (label compound-apply))
(goto (label unknown-procedure-type))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_8_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"apply_dispatch",
      test(list(op("is_primitive_function"), reg("fun"))),
      branch(label("primitive_apply")),
      test(list(op("is_compound_function"), reg("fun"))),
      branch(label("compound_apply")),
      go_to(label("unknown_function_type")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p12' class='permalink'></a><p>
    
    We assume that each primitive is implemented so as to obtain its
    arguments from <kbd>argl</kbd> and place its result in
    <kbd>val</kbd>.  To specify how the machine handles
    primitives, we would have to provide a sequence of controller instructions
    to implement each primitive and arrange for
    
      <span style="color:green"><kbd>primitive-apply</kbd>
      </span>
      <span style="color:blue"><kbd>primitive_apply</kbd>
      </span>
    
    to dispatch to the
    instructions for the primitive identified by the
    contents of
    
      <span style="color:green"><kbd>proc</kbd>.
      </span>
      <span style="color:blue"><kbd>fun</kbd>.</span>
    
    Since we are interested in the structure of the evaluation process rather
    than the details of the primitives, we will instead just use an
    
      <span style="color:green"><kbd>apply-primitive-procedure</kbd></span>
      <span style="color:blue"><kbd>apply_primitive_function</kbd></span> operation
    that applies the
    <span style="color:green">procedure</span><span style="color:blue">function</span>
    in 
    <span style="color:green">proc</span><span style="color:blue">fun</span>
    to the arguments in <kbd>argl</kbd>.  For the purpose of simulating the evaluator with the simulator
    of section&nbsp;<REF NAME="sec:simulator"><a class="superscript" id="5.4.1-sec-link-5.2" href="./5.2.html">5.2</a></REF> we use the
    <span style="color:green">procedure</span><span style="color:blue">function</span>
    
      <span style="color:green"><kbd>apply-primitive-procedure</kbd>,</span>
      <span style="color:blue"><kbd>apply_primitive_function</kbd>,
      </span>
    
    which calls on the underlying
    
      <span style="color:green">Scheme</span>
      <span style="color:blue">JavaScript</span>
    
    system to perform the application, just as we did for the metacircular
    evaluator in section&nbsp;<REF NAME="sec:running-eval"><a class="superscript" id="5.4.1-sec-link-4.1.4" href="./4.1.4.html">4.1.4</a></REF>.  After computing
    the value of the primitive application, we restore
    <kbd>continue</kbd> and go
    to the designated entry point.
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_9_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
primitive-apply
(assign val (op apply-primitive-procedure)
      (reg proc)
      (reg argl))
(restore continue)
(goto (reg continue))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_9_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"primitive_apply",
      assign("val", list(op("apply_primitive_function"), 
                         reg("fun"), 
                         reg("argl"))),
      restore("continue"),
      go_to(reg("continue")),</pre></div></div></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p13' class='permalink'></a><p>
    
    
      <span style="color:green">To apply a compound procedure, we proceed just as with</span>
      <span style="color:blue">
The sequence of instructions labeled
          <kbd>compound_apply</kbd> specifies the
          application of compound functions. To apply a compound
      function, we proceed in a way similar to what we did in</span>
    
    the metacircular evaluator.  We construct a frame
    that binds the
    
      <span style="color:green">procedure's</span>
      <span style="color:blue">function's</span>
    
    parameters to the arguments, use this frame to extend the environment
    carried by the
    
      <span style="color:green">procedure,</span>
      <span style="color:blue">function,</span>
    
    and evaluate in this extended environment 
    
      <span style="color:green">
	the sequence of expressions that forms 
      </span>
    
    the body of the
    
      <span style="color:green">procedure.</span>
      <span style="color:blue">function. </span>
    
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
        <kbd>Ev-sequence</kbd>, described below
        in section&nbsp;<REF NAME="sec:sequence-evaluation"><a class="superscript" id="5.4.1-sec-link-5.4.1" href="./5.4.1.html">5.4.1</a></REF>,
        handles the evaluation of the sequence.
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
        <div class='permalink'>
<a name='p14' class='permalink'></a><p>
	  
          Unlike primitive functions, compound
          functions use the stack as a temporary storage for register values.
          Careful management of the stack is essential for our explicit-control
          evaluator to be tail recursive, and to implement return
          statements. Last, compound functions must also handle the implicit
          returning of <kbd>undefined</kbd> in lieu of
          a return through a return statement. For primitive
          functions, these aspects were all handled for us by the underlying
          JavaScript engine.
      </p></div>
      <div class='permalink'>
<a name='p15' class='permalink'></a><p>
        We will address these three problems together by introducing two new
        instructions for stack management, and two sequences of instructions labeled
        <kbd>ev_return</kbd> for handing explicit
        returns and <kbd>return_undefined</kbd> for
        handling implicit returning of <kbd>undefined</kbd>. First, we explain the need 
        for the additional stack management
        instructions and how they are used during function calls and returns. 
        Then, we will explain implicit returning of <kbd>undefined</kbd>.
        The interaction with tail recursion will be explained in section&nbsp;<REF NAME="sec:tail-recursion-return"><a class="superscript" id="5.4.1-sec-link-5.4.2" href="./5.4.2.html">5.4.2</a></REF>.
      </p></div>
      <div class='permalink'>
<a name='p16' class='permalink'></a><p>
        Returning from a compound function should jump to the value of
        <kbd>continue</kbd> at the time of the
        function call, which was stored on the stack at
        <kbd>ev_application</kbd>. Doing so requires
        that we restore the stack to its state at that moment in time by popping
        all subsequently saved values which are no longer needed. Such values
        may differ in number for different return statements and may be
        introduced in the evaluation of sequences of statements (explained
        shortly) which need temporary storage to process statements in a loop.
        To address this unknown variable,
        <kbd>compound_apply</kbd> pushes a 
        <EM>marker</EM> value on the stack to indicate the top-value of the stack after
        function returns. For simplicity, we introduce a new instruction for pushing
        the marker: <kbd>push_marker_to_stack</kbd>.<a class='superscript' id='footnote-link-6' href='#footnote-6'style="color:green">[6]</a>
      </p></div>
      </span></td></tr></table>
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_10_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
compound-apply
(assign unev (op procedure-parameters) (reg proc))
(assign env (op procedure-environment) (reg proc))
(assign env (op extend-environment)
      (reg unev) (reg argl) (reg env))
(assign unev (op procedure-body) (reg proc))
(goto (label ev-sequence))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_10_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"compound_apply",
      assign("unev", list(op("function_parameters"), reg("fun"))),
      assign("env", list(op("function_environment"), reg("fun"))),
      assign("env", list(op("extend_environment"), 
                         reg("unev"), reg("argl"), reg("env"))),
      assign("comp", list(op("function_body"), reg("fun"))),
      push_marker_to_stack(),
      assign("continue", label("return_undefined")),
      go_to(label("eval_dispatch")),</pre></div></div></td></tr></table>
  </p></div>

    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td>    </td>
          <td></td>
          <td><span style="color:blue">
        <div class='permalink'>
<a name='p17' class='permalink'></a><p>
	  
        When a return statement is evaluated at <kbd>ev_return</kbd>,
        we use the <kbd>revert_stack_to_marker</kbd> instruction to restore the stack to its state at the beginning of the
        function call by popping all values from the stack down to and including
        the marker. 
        As a consequence, <kbd>restore("continue")</kbd>
        will restore the continuation of the function call, which was saved at
        <kbd>ev_application</kbd>. We then proceed to
        evaluate the return expression, whose result will be placed in <kbd>val</kbd>
        and thus be the value returned from the function when we continue after the
        evaluation of the return expression.
      </p></div>
    <div class='snippet' id='javascript_113_11_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_return",
      revert_stack_to_marker(),
      restore("continue"),
      assign("comp", list(op("return_expression"), reg("comp"))),
      go_to(label("eval_dispatch")),</pre></div></div>
      
    <div class='permalink'>
<a name='p18' class='permalink'></a><p>
      If no return statement is encountered during evaluation of the function body,
      evaluation continues at <kbd>return_undefined</kbd>, the
      continuation that was set up at <kbd>compound_apply</kbd>.
      To return <kbd>undefined</kbd> from the function, we put
      <kbd>undefined</kbd> into
      <kbd>val</kbd> and continue to the entry point that was
      put onto the stack at <kbd>ev_application</kbd>. Before we
      can restore that continuation from the stack, however, we must remove the marker
      that was saved at <kbd>compound_apply</kbd>.
      </p></div>

    <div class='snippet' id='javascript_113_12_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"return_undefined",
      revert_stack_to_marker(),
      restore("continue"),
      assign("val", constant(undefined)),
      go_to(reg("continue")),</pre></div></div>
   
      </span></td></tr></table>
  
  
      <div class='permalink'>
        <a name='h4' class='permalink'></a><h2>
     
    <span style="color:blue">Blocks and </span>Sequence Evaluation
  </h2></div>

  
  

  <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td>    </td>
          <td></td>
          <td><span style="color:blue">
      <div class='permalink'>
<a name='p19' class='permalink'></a><p>
        
        
        The body of a block is evaluated with
        respect to the current environment extended by a binding
        of all local names to the value
        <kbd>"*unassigned*"</kbd>.
        We temporarily make use of the <kbd>val</kbd>
        register to hold the list of all variables declared in the block,
        which is obtained by the function <kbd>scan_out_declarations</kbd>
        from section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="5.4.1-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF>.
        
    <div class='snippet' id='javascript_113_13_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_block",
      assign("comp", list(op("block_body"), reg("comp"))),
      assign("val", list(op("scan_out_declarations"), reg("comp"))),

      save("comp"), // temporarily use for *unassigned* values
      assign("comp", list(op("list_of_unassigned"), reg("val"))),
      assign("env", list(op("extend_environment"), 
                         reg("val"), 
                         reg("comp"), 
                         reg("env"))),
      restore("comp"),
      go_to(label("eval_dispatch")),</pre></div></div>
      
      According to section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="5.4.1-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>,
      all lambda expressions and functions have a block as their body. However,
      <kbd>compound_apply</kbd> does not jump to
      <kbd>ev_block</kbd> but to the dispatcher,
      seemingly an additional hoop. By deferring to the dispatcher rather than
      using a fixed label, we open up for more flexible parsing, such as
      foregoing blocks when there are no variable declarations (so no need to
      scan out declarations), or foregoing sequences where there is only a
      single statement. Assuming that the parser follows the specification in
      section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="5.4.1-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>,
      <kbd>compound_apply</kbd> will always jump
      (via the dispatcher) to <kbd>ev_block</kbd>, and
      <kbd>ev_block</kbd> will always jump (via the dispatcher)
      to <kbd>ev_sequence_start</kbd>.
    </p></div>
      
    </span></td></tr></table>
  
  <div class='permalink'>
<a name='p20' class='permalink'></a><p>
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
        The portion of the explicit-control evaluator at
        <kbd>ev-sequence</kbd> is analogous to the
        metacircular evaluator's
        <kbd>eval-sequence</kbd> procedure. It handles
        sequences of expressions in procedure bodies or in explicit
        <kbd>begin</kbd> expressions.
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
        The portion of the explicit-control evaluator beginning at
        <kbd>ev_sequence_start</kbd> is similar to the
        metacircular evaluator's
        <kbd>eval_sequence</kbd> function. It handles
        sequences of statements in function bodies or at the top level.

        The handling of returns in the explicit-control evaluator deviates from
        the metacircular evaluator in order to support tail recursion. Because a
        return statement will ensure that it continues to the proper place in
        the program by manipulating the stack, sequence evaluation does not need to be
        concerned with returns, or even be aware of the existence of 
        return statements in the language.
      </span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p21' class='permalink'></a><p>
    
      <span style="color:green">explicit<kbd>begin</kbd> expressions</span>
      <span style="color:blue">Sequences of statements</span>
    
    are evaluated 
    
      <span style="color:green">
	      by placing the sequence of expressions
      </span>
      <span style="color:blue">
	      at <kbd>ev_sequence_start</kbd> by placing the sequence of statements
      </span>
    
    to be evaluated in
    <kbd>unev</kbd>, saving
    <kbd>continue</kbd> on the
    stack, and jumping to 
    
      <span style="color:green"><kbd>ev-sequence</kbd>.</span>
      <span style="color:blue"><kbd>ev_sequence</kbd>.</span>
    
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_14_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-begin
(assign unev (op begin-actions) (reg exp))
(save continue)
(goto (label ev-sequence))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_14_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_sequence_start",
      assign("unev", list(op("sequence_statements"), reg("comp"))),
      save("continue"),
      go_to(label("ev_sequence")),</pre></div></div></td></tr></table>
    
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
        The implicit sequences in procedure bodies are handled by jumping to
        <kbd>ev-sequence</kbd> from
        <kbd>compound-apply</kbd>, at which point
        <kbd>continue</kbd> is already on the stack, having
        been saved at <kbd>ev-application</kbd>.
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
        Saving <kbd>continue</kbd> allows
        the register to be used in the iteration over the statements in the
        sequence and contributes to values on the stack that will be removed
        during the evaluation of a return statement. 
      </span></td></tr></table>
  </p></div>

  <div class='permalink'>
<a name='p22' class='permalink'></a><p>
    The entries at
    
      <span style="color:green"><kbd>ev-sequence</kbd></span>
      <span style="color:blue"><kbd>ev_sequence</kbd></span>
    
    and
    
      <span style="color:green"><kbd>ev-sequence-continue</kbd></span>
      <span style="color:blue"><kbd>ev_sequence_continue</kbd>
      </span>
    
    form a loop that successively evaluates each
    
      <span style="color:green">
	expression
      </span>
      <span style="color:blue">
	statement
      </span>
    
    in a sequence.  The
    list of unevaluated
    
      <span style="color:green">
	expressions
      </span>
      <span style="color:blue">
	statements
      </span>
    
    is kept in <kbd>unev</kbd>.
    Before evaluating each
    
      <span style="color:green">
	expression,
      </span>
      <span style="color:blue">
	statement,
      </span>
    
    we check to see if there are additional
    
      <span style="color:green">
	expressions
      </span>
      <span style="color:blue">
	statements
      </span>
    
    to be evaluated in the sequence.  If so, we save the rest of the
    unevaluated
    
      <span style="color:green">
	expressions
      </span>
      <span style="color:blue">
	statements
      </span>
    
    (held in <kbd>unev</kbd>) and the
    environment in which these must be evaluated (held in
    <kbd>env</kbd>) and call
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>
      </span>
    
    to evaluate the
    
      <span style="color:green">
	expression.
      </span>
      <span style="color:blue">
	statement.
      </span>
    
    The two saved registers are restored upon
    the return from this evaluation, at
    
      <span style="color:green"><kbd>ev-sequence-continue</kbd>.</span>
      <span style="color:blue"><kbd>ev_sequence_continue</kbd> (or removed by a return statement, as this terminates the function instead of returning to <kbd>ev_sequence_continue</kbd>).
      </span>
    
  </p></div>

  <div class='permalink'>
<a name='p23' class='permalink'></a><p>
    The final
    
      <span style="color:green">
	expression
      </span>
      <span style="color:blue">
	statement
      </span>
    
    in the sequence is handled differently, at the
    entry point
    
      <span style="color:green"><kbd>ev-sequence-last-exp</kbd>.</span>
      <span style="color:blue">
	<kbd>ev_sequence_last_statement</kbd>.
      </span>
    
    Since there are no more
    
      <span style="color:green">
	expressions
      </span>
      <span style="color:blue">
	statements
      </span>
    
    to be evaluated after this one, we need
    not save <kbd>unev</kbd> or
    <kbd>env</kbd> before going to
    
      <span style="color:green"><kbd>eval-dispatch</kbd>.</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>.
    </span>
    The value of the whole sequence is the value of the last
    
      <span style="color:green">
	expression,
      </span>
      <span style="color:blue">
	statement,
      </span>
    
    so
    after the evaluation of the last
    
      <span style="color:green">
	expression
      </span>
      <span style="color:blue">
	statement
      </span>
    
    there is nothing left to do
    except continue at the entry point currently held on the stack (which was
    saved by
    
      <span style="color:green"><kbd>ev-application</kbd> or <kbd>ev-begin</kbd>.)</span>
      <span style="color:blue"><kbd>ev_application</kbd> or <kbd>ev_sequence_start</kbd>.)</span>
    
    Rather than setting up <kbd>continue</kbd> to arrange for
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>
      </span>
    
    to return here and then restoring <kbd>continue</kbd> from
    the stack and continuing at that entry point, we restore
    <kbd>continue</kbd> from the stack before going to
    
      <span style="color:green"><kbd>eval-dispatch</kbd>,</span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>,
      </span>
    
    so that
    
      <span style="color:green"><kbd>eval-dispatch</kbd></span>
      <span style="color:blue"><kbd>eval_dispatch</kbd>
      </span>
    
    will continue at that entry point after evaluating the
    
      <span style="color:green">
	expression.
      </span>
      <span style="color:blue">
	statement.
      </span>
    
    
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_15_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
ev-sequence
(assign exp (op first-exp) (reg unev))
(test (op last-exp?) (reg unev))
(branch (label ev-sequence-last-exp))
(save unev)
(save env)
(assign continue (label ev-sequence-continue))
(goto (label eval-dispatch))
ev-sequence-continue
(restore env)
(restore unev)
(assign unev (op rest-exps) (reg unev))
(goto (label ev-sequence))
ev-sequence-last-exp
(restore continue)
(goto (label eval-dispatch))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_15_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_sequence",
      assign("comp", list(op("first_statement"), reg("unev"))),
      test(list(op("is_last_statement"), reg("unev"))),
      branch(label("ev_sequence_last_statement")),
      save("unev"),
      save("env"),
      assign("continue", label("ev_sequence_continue")),
      go_to(label("eval_dispatch")),
      
"ev_sequence_continue",
      restore("env"),
      restore("unev"),
      assign("unev", list(op("rest_statements"), reg("unev"))),
      go_to(label("ev_sequence")),

"ev_sequence_last_statement",
      restore("continue"),
      go_to(label("eval_dispatch")),</pre></div></div></td></tr></table>
  </p></div>
    </span>    </td>
          <td></td>
          <td><span style="color:blue">
      
      <div class='permalink'>
        <a name='h5' class='permalink'></a><h2>
     
        
          Conditionals
        
      </h2></div>

      <div class='permalink'>
<a name='p24' class='permalink'></a><p>
        
        As with the metacircular evaluator, syntactic forms are handled by selectively
        evaluating fragments of the component. For a conditional, we must evaluate the
        predicate and decide, based on the value of predicate, whether to evaluate the
        consequent or the alternative.
      </p></div>

      <div class='permalink'>
<a name='p25' class='permalink'></a><p>
        Before evaluating the predicate, we save the conditional itself so that we can
        later extract the consequent or alternative. We also save the environment, which
        we will need later in order to evaluate the consequent or the alternative, and we
        save <kbd>continue</kbd>, which we will need later in
        order to return to the evaluation of the statement that is waiting for the value
        of the conditional.<a class='superscript' id='footnote-link-7' href='#footnote-7'style="color:blue">[7]</a>
         
        <div class='snippet' id='javascript_113_16_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_conditional",
  save("comp"), // save conditional for later
  save("env"),
  save("continue"),
  assign("continue", label("ev_conditional_decide")),
  assign("comp", list(op("conditional_predicate"), reg("comp"))),
  go_to(label("eval_dispatch")), // evaluate the predicate</pre></div></div>
      </p></div>

      <div class='permalink'>
<a name='p26' class='permalink'></a><p>
        When we return from evaluating the predicate, we test whether it was true or false
        and, depending on the result, place either the consequent or the alternative in
        <kbd>comp</kbd> before going to
        <kbd>eval_dispatch</kbd>. Notice that restoring
        <kbd>env</kbd> and
        <kbd>continue</kbd> here sets up
        <kbd>eval_dispatch</kbd> to have the correct environment
        and to continue at the right place to receive the value of the conditional.
        <div class='snippet' id='javascript_113_17_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_conditional_decide",
  restore("continue"),
  restore("env"),
  restore("comp"),
  test(list(op("is_falsy"), reg("val"))),
  branch(label("ev_conditional_alternative")),
"ev_conditional_consequent",
  assign("comp", list(op("conditional_consequent"), reg("comp"))),
  go_to(label("eval_dispatch")),
"ev_conditional_alternative",
  assign("comp", list(op("conditional_alternative"), reg("comp"))),
  go_to(label("eval_dispatch")),</pre></div></div>
      </p></div>

      
      <div class='permalink'>
        <a name='h6' class='permalink'></a><h2>
     
        
          Sequence Evaluation
        
      </h2></div>

      <div class='permalink'>
<a name='p27' class='permalink'></a><p>
        
        The portion of the explicit-control evaluator beginning at
        <kbd>ev_sequence</kbd>, which handles sequences of
        statements. is analogous to the metacircular evaluator's
        <kbd>eval_sequence</kbd> function.  
      </p></div>
      <div class='permalink'>
<a name='p28' class='permalink'></a><p>
        The entries at <kbd>ev_sequence_next</kbd> and
        <kbd>ev_sequence_continue</kbd> form a loop that
        successively evaluates each statement in a sequence.
        (Empty sequences avoid the loop and jump straight to <kbd>continue</kbd> via
        <kbd>ev_sequence_empty</kbd>.)
        The list of unevaluated
        statements is kept in <kbd>unev</kbd>. At
        <kbd>ev_sequence</kbd>, before starting the loop, we
        place the sequence of statements to be evaluated in
        <kbd>unev</kbd> and save
        <kbd>continue</kbd> on the stack,
        
        because it will be used for local flow of control in the loop, and the original
        value is needed for continuing after the statement sequence. Before evaluating
        each statement, we check to see if there are additional statements to be evaluated
        in the sequence. If so, we save the rest of the unevaluated statements (held in
        <kbd>unev</kbd>) and the environment in which these must
        be evaluated (held in <kbd>env</kbd>) and call
        <kbd>eval_dispatch</kbd> to evaluate the statement. The
        two saved registers are restored after this evaluation, at
        <kbd>ev_sequence_continue</kbd>.
      </p></div>
      <div class='permalink'>
<a name='p29' class='permalink'></a><p>
        The final statement in the sequence is handled differently, at the entry point
        <kbd>ev_sequence_last_statement</kbd>. Since there are
        no more statements to be evaluated after this one, we need not save
        <kbd>unev</kbd> or
        <kbd>env</kbd> before going to
        <kbd>eval_dispatch</kbd>. The value of the whole
        sequence is the value of the last statement, so after the evaluation of the last
        statement there is nothing left to do except continue at the entry point that was
        saved at <kbd>ev_sequence</kbd>.
        Rather than setting up <kbd>continue</kbd> to arrange
        for <kbd>eval_dispatch</kbd> to return here and then
        restoring <kbd>continue</kbd> from the stack and
        continuing at that entry point, we restore
        <kbd>continue</kbd> from the stack before going to
        <kbd>eval_dispatch</kbd>, so that
        <kbd>eval_dispatch</kbd> will continue at that entry
        point after evaluating the statement.
        
        
        
        
        
        
        
        
      </p></div>

      <div class='snippet' id='javascript_113_18_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
"ev_sequence",
  assign("unev", list(op("sequence_statements"), reg("comp"))),
  test(list(op("is_empty_sequence"), reg("unev"))), 
  branch(label("ev_sequence_empty")),
  save("continue"),
"ev_sequence_next",
  assign("comp", list(op("first_statement"), reg("unev"))),
  test(list(op("is_last_statement"), reg("unev"))),
  branch(label("ev_sequence_last_statement")),
  save("unev"),
  save("env"),
  assign("continue", label("ev_sequence_continue")),
  go_to(label("eval_dispatch")),
"ev_sequence_continue",
  restore("env"),
  restore("unev"),
  assign("unev", list(op("rest_statements"), reg("unev"))),
  go_to(label("ev_sequence_next")),
"ev_sequence_last_statement",
  restore("continue"),
  go_to(label("eval_dispatch")),
"ev_sequence_empty",
  go_to(reg("continue")),</pre></div></div>

      <div class='permalink'>
<a name='p30' class='permalink'></a><p>
        Unlike <kbd>eval_sequence</kbd> in the metacircular
        evaluator, <kbd>ev_sequence</kbd> does not need to check whether a return statement was
        evaluated so as to terminate the sequence evaluation. The <QUOTE>explicit
        control</QUOTE> in this evaluator allows a return statement to jump directly to
        the continuation of the current function application without resuming the
        sequence evaluation. Thus sequence evaluation does not need to be concerned
        with returns, or even be aware of the existence of return statements in the
        language. Because a return statement jumps out of the sequence-evaluation code,
        the restores of saved registers won't be executed. We will see how the
        return statement removes these from the stack.
        
      </p></div>
      
    </span></td></tr></table>
<hr>

    <div class='footnote'>
      <a class='footnote-number' id='footnote-1' href='#footnote-link-1' >[1] </a>
    <FOOTNOTE>
    In our controller, the dispatch is written as a sequence of
    <kbd>test</kbd> and <kbd>branch</kbd>
    instructions. Alternatively, it could have been written in a data-directed style (and
    in a real system it probably would have been) to avoid the need to perform sequential
    tests and to facilitate the definition of new
    <span style="color:green">expression</span><span style="color:blue">component</span>
    types.
    
      <span style="color:green">
        A machine designed to run Lisp would probably include a
        <kbd>dispatch-on-type</kbd> instruction
        that would efficiently execute such data-directed
        dispatches.
      </span>
      <span style="color:blue">
        Most common JavaScript implementations today do not interpret the JavaScript
        source code directly. Instead, source is transformed into an intermediate
        representation called <EM>bytecode</EM>, which is typically interpreted in a loop
        similar to our dispatch functions. Some JavaScript interpreters are register
        machines, like ours; others are stack machines, in which operations pop and push
        operands from and to a stack instead of keeping a large number of registers. For
        performance reasons, most JavaScript interpreters compile commonly executed parts
        of a program from bytecode to machine code. This is called Just-In-Time
        compilation (JIT). We will address compilation in section
        <REF NAME="sec:compilation"><a class="superscript" id="5.4.1-sec-link-5.5" href="./5.5.html">5.5</a></REF>.
      </span>
    
  
    </FOOTNOTE></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-2' href='#footnote-link-2' style="color:green">[2] </a>
    <FOOTNOTE>
    This is an important but subtle point in translating
    algorithms from a procedural language, such as
    
      <span style="color:green">Lisp,</span>
      <span style="color:blue">JavaScript,</span>
    
    to a register-machine language.  As an alternative to saving only what is
    needed, we could save all the registers (except
    <kbd>val</kbd>) before each recursive call.
    This is called a 
    
    
    <EM>framed-stack</EM> discipline.  This
    would work but might save more registers than necessary; this could be
    an important consideration in a system where stack operations are
    expensive.  Saving registers whose contents will not be needed later
    may also hold on to useless data that could otherwise be
    garbage-collected, freeing space to be reused.
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-3' href='#footnote-link-3' style="color:green">[3] </a>
    <FOOTNOTE>
    We add to the evaluator data-structure
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    in section&nbsp;<REF NAME="sec:eval-data-structures"><a class="superscript" id="5.4.1-sec-link-4.1.3" href="./4.1.3.html">4.1.3</a></REF> the following two
    
      <span style="color:green">procedures</span>
      <span style="color:blue">functions</span>
    
    for manipulating argument lists:
     
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_19_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (empty-arglist) '())

(define (adjoin-arg arg arglist)
  (append arglist (list arg)))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_19_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function empty_arglist() { return null; }

function adjoin_arg(arg, arglist) {
    return append(arglist, list(arg));
}</pre></div></div></td></tr></table>
    We also use an additional syntax
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    to test for the last
  
    <span style="color:green">operand in a combination:</span>
    <span style="color:blue">argument expression in an application:</span>
  
     
    <table width="100%">
          <colgroup><col width="48%"><col width="52%"></colgroup>
          
          <tr>
            <td><div class='snippet' id='javascript_113_20_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
(define (last-operand? ops)
(null? (cdr ops)))</pre></div></div>    </td>
            <td><div class='snippet' id='javascript_113_20_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function is_last_argument_expression(arg_expression) {
    return is_null(tail(arg_expression));
}</pre></div></div></td></tr></table>
  
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-4' href='#footnote-link-4' style="color:green">[4] </a>
    <FOOTNOTE>
    The optimization of
    treating the last 
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    
    specially is known as <EM>evlis tail recursion</EM> (see 
    
    <CITATION>Wand 1980</CITATION>). We could be somewhat more efficient
    in the argument evaluation loop if we made evaluation of the first
  
    <span style="color:green">operand</span>
    <span style="color:blue">argument expression</span>
  
    a special case too.  This would permit us to postpone
    initializing <kbd>argl</kbd> until after evaluating the
    first
    
      <span style="color:green">
	operand,
      </span>
      <span style="color:blue">
	argument expression,
      </span>
    
    so
    as to avoid saving <kbd>argl</kbd> in this case.  The
    compiler in section&nbsp;<REF NAME="sec:compilation"><a class="superscript" id="5.4.1-sec-link-5.5" href="./5.5.html">5.5</a></REF> performs this
    optimization.  (Compare the
    
      <span style="color:green"><kbd>construct-arglist</kbd></span>
      <span style="color:blue"><kbd>construct_arglist</kbd>
      </span>
    
    
      <span style="color:green">procedure</span>
      <span style="color:blue">function</span>
    
    of section&nbsp;<REF NAME="sec:compiling-combinations"><a class="superscript" id="5.4.1-sec-link-5.5.3" href="./5.5.3.html">5.5.3</a></REF>.)
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-5' href='#footnote-link-5' style="color:green">[5] </a>
    <FOOTNOTE>
    
    <table width="100%">
        <colgroup><col width="48%"><col width="1%"><col width="51%"></colgroup>
        <tr>
          <td class="meta" style = "color:grey; text-align: center">Original</td>
          <td></td>
          <td class="meta" style = "color:grey; text-align: center">JavaScript</td>
        </tr>
        <tr><td><span style="color:green">
        The order of operand evaluation in the metacircular evaluator is
        determined by the order of evaluation of the arguments to
        <kbd>cons</kbd> in the procedure
        <kbd>list-of-values</kbd> of section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="5.4.1-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF> (see exercise&nbsp;<REF NAME="ex:arg-eval-order"><a class="superscript" id="5.4.1-ex-link-4.2" href="./4.1.1.html#ex_4.2">4.2</a></REF>).
      </span>    </td>
          <td></td>
          <td><span style="color:blue">
        The order of argument-expression evaluation by the function
        <kbd>list_of_values</kbd> in the metacircular
        evaluator is determined by the order of evaluation of the arguments to
        <kbd>pair</kbd>, which is used to construct the
        argument list. The version of
        <kbd>list_of_values</kbd>
        in footnote&nbsp;<REF NAME="foot:mceval-higher-order"><a class="superscript" id="5.4.1-foot-link-3" href="./4.1.1.html#footnote-3">3</a></REF> of section&nbsp;<REF NAME="sec:mc-eval"><a class="superscript" id="5.4.1-sec-link-4.1" href="./4.1.html">4.1</a></REF> calls <kbd>pair</kbd>
        directly; the version in the text uses
        <kbd>map</kbd>, which calls
        <kbd>pair</kbd>.
        (See exercise&nbsp;<REF NAME="ex:arg-eval-order"><a class="superscript" id="5.4.1-ex-link-4.2" href="./4.1.1.html#ex_4.2">4.2</a></REF>.)
      </span></td></tr></table>
    
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:green">
      <a class='footnote-number' id='footnote-6' href='#footnote-link-6' style="color:green">[6] </a>
    <FOOTNOTE>
    
        The special instruction <kbd>push_marker_to_stack</kbd> and its counterpart,
        <kbd>revert_stack_to_marker</kbd>, are not strictly
        necessary and could be implemented by explicitly pushing and popping a
        marker value onto and off the stack. Anything that could not be confused
        for a value in the program can be used as a marker, for example
        a pointer to a specific list or function object.
        See exercise <REF NAME="ex:push_marker_to_stack1"><a class="superscript" id="5.4.1-ex-link-5.24" href="./5.4.2.html#ex_5.24">5.24</a></REF>.
      
    </FOOTNOTE></span></div>
    
    
    <div class='footnote'><span style="color:blue">
      <a class='footnote-number' id='footnote-7' href='#footnote-link-7' style="color:blue">[7] </a>
    <FOOTNOTE>
    

        In this chapter, we will use the function
        <kbd>is_falsy</kbd> to test the value of the predicate.
        This allows us to write the consequent and the alternate branches in the same
        order as they appear in a conditional, and simply fall through to the consequent
        branch when the predicate holds. The function is declared as the opposite of the
        <kbd>is_truthy</kbd> function used to test predicates of
        conditionals in section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="5.4.1-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF>.
        
        
    </FOOTNOTE></span></div>
    
    
</div></div>

    <div class='nav'>
  
        <a class='btn btn-secondary btn-nav' href='./5.4.html'>&lt; Previous</a>
    
    <div style='flex-grow: 1;'></div>
  
        <a class='btn btn-secondary btn-nav' id='115' href='./5.4.2.html'>Next &gt;</a>
      </div>
    <div class='chapter_sign'>
      5.4.1&nbsp;&nbsp;
    
      <span style="color:green">The Core of the Explicit-Control Evaluator</span>
      <span style="color:blue">The Dispatcher and Basic Evaluation</span>
    
  
    </div>
    <script> var chapter_id = 114; </script>
    <script> var chapter_path = "chapters/5.4.1.html"; </script>
    <div class='next-page'></div>
    </div>
    </div> <!-- /.container -->
    </body></html>